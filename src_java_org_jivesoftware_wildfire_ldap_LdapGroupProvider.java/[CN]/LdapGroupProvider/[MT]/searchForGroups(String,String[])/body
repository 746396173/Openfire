{
  if (manager.isDebugEnabled()) {
    Log.debug("Trying to find all groups in the system.");
  }
  DirContext ctx=null;
  NamingEnumeration<SearchResult> answer;
  try {
    ctx=manager.getContext();
    if (manager.isDebugEnabled()) {
      Log.debug("Starting LDAP search...");
      Log.debug("Using groupSearchFilter: " + searchFilter);
    }
    SearchControls searchControls=new SearchControls();
    searchControls.setReturningAttributes(returningAttributes);
    searchControls.setSearchScope(SearchControls.SUBTREE_SCOPE);
    answer=ctx.search("",searchFilter,searchControls);
    if (manager.isDebugEnabled()) {
      Log.debug("... search finished");
    }
    return answer;
  }
 catch (  Exception e) {
    if (manager.isDebugEnabled()) {
      Log.debug("Error while searching for groups.",e);
    }
    return null;
  }
 finally {
    if (ctx != null) {
      try {
        ctx.close();
      }
 catch (      Exception ex) {
      }
    }
  }
}

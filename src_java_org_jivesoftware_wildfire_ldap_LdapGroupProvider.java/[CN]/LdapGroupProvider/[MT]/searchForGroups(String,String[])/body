{
  if (manager.isDebugEnabled()) {
    Log.debug("Trying to find all groups in the system.");
  }
  LdapContext ctx=null;
  NamingEnumeration<SearchResult> answer;
  try {
    ctx=manager.getContext();
    Control[] searchControl=new Control[]{new SortControl(new String[]{manager.getGroupNameField()},Control.NONCRITICAL)};
    ctx.setRequestControls(searchControl);
    if (manager.isDebugEnabled()) {
      Log.debug("Starting LDAP search...");
      Log.debug("Using groupSearchFilter: " + searchFilter);
    }
    SearchControls searchControls=new SearchControls();
    searchControls.setReturningAttributes(returningAttributes);
    if (manager.isSubTreeSearch()) {
      searchControls.setSearchScope(SearchControls.SUBTREE_SCOPE);
    }
 else {
      searchControls.setSearchScope(SearchControls.ONELEVEL_SCOPE);
    }
    answer=ctx.search("",searchFilter,searchControls);
    if (manager.isDebugEnabled()) {
      Log.debug("... search finished");
    }
    return answer;
  }
  finally {
    if (ctx != null) {
      try {
        ctx.close();
      }
 catch (      Exception ex) {
      }
    }
  }
}

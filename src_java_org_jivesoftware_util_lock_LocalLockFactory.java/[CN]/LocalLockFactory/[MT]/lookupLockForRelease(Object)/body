{
  ReentrantLock lock=locks.get(key);
  if (lock == null) {
    throw new IllegalStateException("No lock found for object " + key);
  }
  Integer count=counts.get(key);
  if (count == null) {
    throw new IllegalStateException("No count found for object " + key);
  }
  if (count == 1) {
    counts.remove(key);
  }
 else {
    counts.put(key,--count);
  }
  return lock;
}

{
  if (isEnabled()) {
    final long requestFrequency=JiveGlobals.getLongProperty("stream.management.requestFrequency",5);
    final boolean requestAck;
synchronized (this) {
      final long x=1 + (unacknowledgedServerStanzas.isEmpty() ? clientProcessedStanzas : unacknowledgedServerStanzas.getLast().x);
      unacknowledgedServerStanzas.addLast(new StreamManager.UnackedPacket(x,packet.createCopy()));
      requestAck=unacknowledgedServerStanzas.size() >= requestFrequency;
      Log.debug("Added stanza of type {} to collection of unacknowledged stanzas (x={}). Collection size is now {} / {}",packet.getElement().getName(),x,unacknowledgedServerStanzas.size());
    }
    if (requestAck) {
      sendServerRequest();
    }
  }
}

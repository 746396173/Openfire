{
  if (update.getFrom() == null) {
    return;
  }
  if (localServer.isLocal(update.getFrom())) {
    Set set=(Set)directedPresences.get(update.getFrom().toString());
    if (set != null) {
      RoutableChannelHandler handler;
      for (Iterator it=set.iterator(); it.hasNext(); ) {
        handler=(RoutableChannelHandler)((HandlerWeakReference)it.next()).get();
        if (handler != null) {
          update.setTo(handler.getAddress());
          try {
            handler.process(update);
          }
 catch (          UnauthorizedException ue) {
            Log.error(ue);
          }
        }
      }
      directedPresences.remove(update.getFrom().toString());
    }
  }
}

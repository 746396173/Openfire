{
  if (update.getFrom() == null) {
    return;
  }
  if (localServer.isLocal(update.getFrom())) {
    Map<ChannelHandler,Set<String>> map=directedPresences.get(update.getFrom().toString());
    if (map != null) {
      for (      ChannelHandler handler : map.keySet()) {
        for (        String jid : map.get(handler)) {
          Presence presence=update.createCopy();
          presence.setTo(new JID(jid));
          try {
            handler.process(presence);
          }
 catch (          UnauthorizedException ue) {
            Log.error(ue);
          }
        }
      }
      directedPresences.remove(update.getFrom().toString());
    }
  }
}

{
  String S="";
  List<String> discoIdentities=new ArrayList<String>();
  Element query=packet.getChildElement();
  Iterator identitiesIterator=query.elementIterator("identity");
  if (identitiesIterator != null) {
    while (identitiesIterator.hasNext()) {
      Element identityElement=(Element)identitiesIterator.next();
      String discoIdentity=identityElement.attributeValue("category");
      discoIdentity+='/';
      discoIdentity+=identityElement.attributeValue("type");
      discoIdentities.add(discoIdentity);
    }
    Collections.sort(discoIdentities);
  }
  for (  String discoIdentity : discoIdentities) {
    S+=discoIdentity;
    S+='<';
  }
  List<String> discoFeatures=new ArrayList<String>();
  Iterator featuresIterator=query.elementIterator("feature");
  if (featuresIterator != null) {
    while (featuresIterator.hasNext()) {
      Element featureElement=(Element)featuresIterator.next();
      String discoFeature=featureElement.attributeValue("var");
      discoFeatures.add(discoFeature);
    }
    Collections.sort(discoFeatures);
  }
  for (  String discoFeature : discoFeatures) {
    S+=discoFeature;
    S+='<';
  }
  S=StringUtils.hash(S,"SHA-1");
  S=StringUtils.encodeBase64(StringUtils.decodeHex(S));
  return S;
}

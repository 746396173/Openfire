{
  sessionLock.readLock().lock();
  try {
    Iterator values=sessions.values().iterator();
    while (values.hasNext()) {
      ((SessionMap)values.next()).broadcast(packet);
    }
  }
  finally {
    sessionLock.readLock().unlock();
  }
  anonymousSessionLock.readLock().lock();
  try {
    Iterator values=anonymousSessions.values().iterator();
    while (values.hasNext()) {
      ((Session)values.next()).getConnection().deliver(packet);
    }
  }
  finally {
    anonymousSessionLock.readLock().unlock();
  }
}

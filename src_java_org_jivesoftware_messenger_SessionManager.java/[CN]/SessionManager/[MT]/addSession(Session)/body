{
  boolean success=false;
  String username=session.getAddress().getNode().toLowerCase();
  SessionMap resources=null;
synchronized (username.intern()) {
    try {
      resources=sessions.get(username);
      if (resources == null) {
        resources=new SessionMap();
        sessions.put(username,resources);
      }
      resources.addSession(session);
      session.getConnection().registerCloseListener(this,session);
      preAuthenticatedSessions.remove(new JID(null,session.getAddress().getDomain(),session.getStreamID().toString()).toString());
      success=true;
    }
 catch (    UnauthorizedException e) {
      Log.error(LocaleUtils.getLocalizedString("admin.error"),e);
    }
  }
  return success;
}

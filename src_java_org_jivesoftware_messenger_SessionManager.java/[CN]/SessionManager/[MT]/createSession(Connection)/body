{
  if (serverName == null) {
    throw new UnauthorizedException("Server not initialized");
  }
  StreamID id=streamIDFactory.createStreamID();
  Session session=new SessionImpl(serverName,conn,id);
  conn.init(session);
  conn.registerCloseListener(this,session);
  preAuthenticatedSessions.put(session.getAddress().toString(),session);
  return session;
}

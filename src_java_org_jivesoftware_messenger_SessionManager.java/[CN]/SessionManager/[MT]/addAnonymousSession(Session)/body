{
  try {
    anonymousSessionLock.writeLock().lock();
    try {
      anonymousSessions.put(session.getAddress().getResource(),session);
      session.getConnection().registerCloseListener(this,session);
      preAuthenticatedSessions.remove(session.getAddress().toString());
    }
  finally {
      anonymousSessionLock.writeLock().unlock();
    }
    routingTable.addRoute(session.getAddress(),session);
  }
 catch (  UnauthorizedException e) {
    Log.error(LocaleUtils.getLocalizedString("admin.error"),e);
  }
}

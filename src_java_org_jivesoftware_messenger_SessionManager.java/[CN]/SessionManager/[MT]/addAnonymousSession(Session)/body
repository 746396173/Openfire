{
  try {
    JID newAddress=new JID(session.getAddress().getNode(),session.getAddress().getDomain(),Integer.toHexString(randomResource.nextInt()));
    session.setAddress(newAddress);
    anonymousSessionLock.writeLock().lock();
    try {
      anonymousSessions.put(session.getAddress().getResource(),session);
      session.getConnection().registerCloseListener(this,session);
    }
  finally {
      anonymousSessionLock.writeLock().unlock();
    }
    routingTable.addRoute(session.getAddress(),session);
  }
 catch (  UnauthorizedException e) {
    Log.error(LocaleUtils.getLocalizedString("admin.error"),e);
  }
}

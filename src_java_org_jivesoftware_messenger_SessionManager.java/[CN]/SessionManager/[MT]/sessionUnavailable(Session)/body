{
  if (session.getAddress() != null && routingTable != null && session.getAddress().toBareJID().trim().length() != 0) {
    routingTable.removeRoute(session.getAddress());
    try {
      String username=session.getUsername().toLowerCase();
      SessionMap sessionMap=sessions.get(username);
      if (sessionMap == null) {
        JID userJID=new JID(session.getUsername(),serverName,"");
        try {
          routingTable.getRoute(userJID);
          routingTable.removeRoute(new JID(session.getAddress().getNode(),session.getAddress().getDomain(),""));
        }
 catch (        NoSuchRouteException e) {
        }
      }
 else       if (sessionMap.getAvailableSessions().isEmpty()) {
        routingTable.removeRoute(new JID(session.getAddress().getNode(),session.getAddress().getDomain(),""));
      }
 else {
        Session defaultSession=sessionMap.getDefaultSession(true);
        routingTable.addRoute(new JID(defaultSession.getAddress().getNode(),defaultSession.getAddress().getDomain(),""),defaultSession);
      }
    }
 catch (    UserNotFoundException e) {
    }
catch (    UnauthorizedException e) {
    }
  }
}

{
  lastPacketTime=System.currentTimeMillis();
  JID recipient=packet.getTo();
  String group=recipient.getNode();
  if (group == null) {
    Log.info(LocaleUtils.getLocalizedString("muc.error.not-supported") + " " + packet.toString());
  }
 else {
    MUCRole role=roles.get(group.toLowerCase());
    if (role == null) {
    }
 else {
      if (!role.getChatUser().getAddress().equals(packet.getFrom())) {
        sendErrorPacket(packet,PacketError.Condition.conflict);
      }
 else {
        try {
          if ("query".equals(packet.getElement().getNamespacePrefix()) && "http://jabber.org/protocol/muc#owner".equals(packet.getElement().getNamespaceURI())) {
            role.getChatRoom().getIQOwnerHandler().handleIQ(packet,role);
          }
 else           if ("query".equals(packet.getElement().getNamespacePrefix()) && "http://jabber.org/protocol/muc#admin".equals(packet.getElement().getNamespaceURI())) {
            role.getChatRoom().getIQAdminHandler().handleIQ(packet,role);
          }
 else {
            sendErrorPacket(packet,PacketError.Condition.bad_request);
          }
        }
 catch (        ForbiddenException e) {
          sendErrorPacket(packet,PacketError.Condition.forbidden);
        }
catch (        ConflictException e) {
          sendErrorPacket(packet,PacketError.Condition.conflict);
        }
catch (        NotAllowedException e) {
          sendErrorPacket(packet,PacketError.Condition.not_allowed);
        }
      }
    }
  }
}

{
  if (presence == null) {
    return;
  }
  if (hasToCheckRoleToBroadcastPresence()) {
    Element frag=presence.getChildElement("x","http://jabber.org/protocol/muc#user");
    if (!canBroadcastPresence(frag.element("item").attributeValue("role"))) {
      try {
        MUCRole occupant=getOccupant(presence.getFrom().getResource());
        occupant.send(presence);
      }
 catch (      UserNotFoundException e) {
      }
      return;
    }
  }
  BroascastPresenceRequest request=new BroascastPresenceRequest(this,presence);
  CacheFactory.doClusterTask(request);
  request=new BroascastPresenceRequest(this,presence);
  request.setOriginator(true);
  request.run();
}

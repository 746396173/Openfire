{
  if (occupants.containsKey(event.getNickname().toLowerCase())) {
    return;
  }
  RemoteMUCRole joinRole=new RemoteMUCRole(mucService,event);
  occupants.put(event.getNickname().toLowerCase(),joinRole);
  JID bareJID=event.getUserAddress().asBareJID();
  List<MUCRole> list=occupantsByBareJID.get(bareJID);
  if (list == null) {
    list=new ArrayList<MUCRole>();
    occupantsByBareJID.put(bareJID,list);
  }
  list.add(joinRole);
  occupantsByFullJID.put(event.getUserAddress(),joinRole);
  setEmptyDate(null);
  if (event.isOriginator()) {
    MUCEventDispatcher.occupantJoined(getRole().getRoleAddress(),event.getUserAddress(),joinRole.getNickname());
  }
  if (event.isSendPresence()) {
    for (    MUCRole occupant : occupants.values()) {
      if (occupant.isLocal()) {
        occupant.send(event.getPresence().createCopy());
      }
    }
  }
}

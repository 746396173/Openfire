{
  if (IQ.Type.error == originalPacket.getType()) {
    Log.error("Cannot reply an IQ error to another IQ error: " + originalPacket);
    return;
  }
  IQ reply=IQ.createResultIQ(originalPacket);
  reply.setChildElement(originalPacket.getChildElement().createCopy());
  reply.setError(condition);
  if (serverName.equals(originalPacket.getFrom().toString())) {
    handle(reply);
    return;
  }
  ChannelHandler route=routingTable.getRoute(originalPacket.getFrom());
  if (route != null) {
    route.process(reply);
  }
 else {
    Session session=sessionManager.getSession(originalPacket.getFrom());
    if (session != null) {
      session.process(reply);
    }
 else {
      Log.warn("Error packet could not be delivered " + reply);
    }
  }
}

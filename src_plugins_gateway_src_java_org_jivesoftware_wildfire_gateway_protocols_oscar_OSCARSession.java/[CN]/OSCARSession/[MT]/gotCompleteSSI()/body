{
  getRegistration().setLastLogin(new Date());
  List<TransportBuddy> legacyusers=new ArrayList<TransportBuddy>();
  for (  BuddyItem buddy : buddies.values()) {
    String nickname=buddy.getAlias();
    if (nickname == null || nickname.matches("/^\\s*$/")) {
      nickname=buddy.getScreenname();
    }
    try {
      if (nickname.equalsIgnoreCase(buddy.getScreenname())) {
        Integer buddyUIN=Integer.parseInt(buddy.getScreenname());
        Log.debug("REQUESTING SHORT INFO FOR " + buddyUIN);
        request(new MetaFullInfoRequest(getUIN(),(int)nextIcqId(),buddyUIN));
      }
    }
 catch (    NumberFormatException e) {
    }
    if (nickname == null) {
      nickname=buddy.getScreenname();
    }
    int groupid=buddy.getGroupId();
    String groupname=null;
    if (groupid != 0 && groups.containsKey(groupid)) {
      String newgroupname=groups.get(groupid).getGroupName();
      if (newgroupname.length() > 0) {
        groupname=newgroupname;
      }
    }
    legacyusers.add(new TransportBuddy(buddy.getScreenname(),nickname,groupname));
  }
  try {
    getTransport().syncLegacyRoster(getJID(),legacyusers);
  }
 catch (  UserNotFoundException e) {
    Log.error("Unable to sync oscar contact list for " + getJID(),e);
  }
  updateStatus(this.presenceType,this.verboseStatus);
  if (getTransport().getType().equals(TransportType.icq)) {
    request(new OfflineMsgIcqRequest(getUIN(),(int)nextIcqId()));
  }
}

{
  if (grouplist.isEmpty()) {
    grouplist.add("Transport Buddies");
  }
  for (  String group : grouplist) {
    Integer groupId=getGroupIdOrCreateNew(group);
    Integer newBuddyId=1;
    if (highestBuddyIdPerGroup.containsKey(groupId)) {
      newBuddyId=highestBuddyIdPerGroup.get(groupId) + 1;
    }
    highestBuddyIdPerGroup.put(groupId,newBuddyId);
    BuddyItem newBuddy=new BuddyItem(contact,newBuddyId,groupId);
    newBuddy.setAlias(nickname);
    request(new CreateItemsCmd(newBuddy.toSsiItem()));
    buddies.put(groupId + "." + newBuddyId,newBuddy);
  }
  for (  BuddyItem buddy : buddies.values()) {
    if (buddy.getScreenname().equals(contact)) {
      if (buddy.getGroupId() == 0) {
        request(new DeleteItemsCmd(buddy.toSsiItem()));
        buddies.remove(buddy.getGroupId() + "." + buddy.getId());
      }
 else       if (!groups.contains(buddy.getGroupId())) {
        request(new DeleteItemsCmd(buddy.toSsiItem()));
        buddies.remove(buddy.getGroupId() + "." + buddy.getId());
      }
 else       if (!grouplist.contains(groups.get(buddy.getGroupId()).getGroupName())) {
        request(new DeleteItemsCmd(buddy.toSsiItem()));
        buddies.remove(buddy.getGroupId() + "." + buddy.getId());
      }
 else {
        if (!buddy.getAlias().equals(nickname)) {
          buddy.setAlias(nickname);
          request(new ModifyItemsCmd(buddy.toSsiItem()));
        }
      }
    }
  }
}

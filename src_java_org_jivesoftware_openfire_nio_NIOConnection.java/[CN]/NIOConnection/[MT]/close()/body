{
  boolean closedSuccessfully=false;
synchronized (this) {
    if (!isClosed()) {
      try {
        deliverRawText(flashClient ? "</flash:stream>" : "</stream:stream>",false);
      }
 catch (      Exception e) {
      }
      if (session != null) {
        session.setStatus(Session.STATUS_CLOSED);
      }
      ioSession.close();
      closed=true;
      closedSuccessfully=true;
    }
  }
  if (closedSuccessfully) {
    notifyCloseListeners();
  }
}

{
  this.regListener=listener;
  xmppProviderFactory=ProtocolProviderFactory.getProtocolProviderFactory(FocusBundleActivator.bundleContext,ProtocolNames.JABBER);
  if (xmppLoginPassword != null) {
    xmppAccount=xmppProviderFactory.createAccount(FocusAccountFactory.createFocusAccountProperties(serverAddress,xmppDomain,nickName,xmppLoginPassword));
  }
 else {
    xmppAccount=xmppProviderFactory.createAccount(FocusAccountFactory.createFocusAccountProperties(serverAddress,xmppDomain,nickName));
  }
  if (!xmppProviderFactory.loadAccount(xmppAccount)) {
    throw new RuntimeException("Failed to load account: " + xmppAccount);
  }
  ServiceReference protoRef=xmppProviderFactory.getProviderForAccount(xmppAccount);
  protocolService=(ProtocolProviderService)FocusBundleActivator.bundleContext.getService(protoRef);
  protocolService.addRegistrationStateChangeListener(this);
}

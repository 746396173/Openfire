{
  super(registration,jid,transport,priority);
  if (Email.parseStr(registration.getUsername()) == null) {
    Message m=new Message();
    m.setType(Message.Type.error);
    m.setTo(getJID());
    m.setFrom(getTransport().getJID());
    m.setBody(LocaleUtils.getLocalizedString("gateway.msn.illegalaccount","gateway") + " " + registration.getUsername());
    return;
  }
  Log.debug("Creating MSN session for " + registration.getUsername());
  msnMessenger=MsnMessengerFactory.createMsnMessenger(registration.getUsername(),registration.getPassword());
  ((BasicMessenger)msnMessenger).addSessionListener(new MSNSessionListener(this));
  msnMessenger.setSupportedProtocol(new MsnProtocol[]{MsnProtocol.MSNP11});
}

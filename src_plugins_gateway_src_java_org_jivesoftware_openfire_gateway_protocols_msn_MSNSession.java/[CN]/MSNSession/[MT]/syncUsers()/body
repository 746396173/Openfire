{
  List<TransportBuddy> legacyusers=new ArrayList<TransportBuddy>();
  for (  MsnContact friend : msnContacts.values()) {
    ArrayList<String> friendGroups=new ArrayList<String>();
    for (    MsnGroup group : friend.getBelongGroups()) {
      Log.debug("MSN: Found belong group for " + friend + " as "+ group);
      friendGroups.add(group.getGroupName());
    }
    if (friendGroups.size() > 0) {
      legacyusers.add(new TransportBuddy(friend.getEmail().toString(),friend.getFriendlyName(),friendGroups.get(0)));
    }
 else {
      legacyusers.add(new TransportBuddy(friend.getEmail().toString(),friend.getFriendlyName(),null));
    }
  }
  try {
    getTransport().syncLegacyRoster(getJID(),legacyusers);
  }
 catch (  UserNotFoundException e) {
    Log.error("Unable to sync MSN contact list for " + getJID(),e);
  }
  for (  MsnContact friend : msnContacts.values()) {
    Presence p=new Presence();
    p.setTo(getJID());
    p.setFrom(getTransport().convertIDToJID(friend.getEmail().toString()));
    ((MSNTransport)getTransport()).setUpPresencePacket(p,friend.getStatus());
    getTransport().sendPacket(p);
  }
}

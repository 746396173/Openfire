{
  restartNeeded=false;
  certificateListener=new CertificateListener();
  CertificateManager.addListener(certificateListener);
  adminPort=JiveGlobals.getXMLProperty("adminConsole.port",9090);
  adminSecurePort=JiveGlobals.getXMLProperty("adminConsole.securePort",9091);
  adminServer=new Server();
  final QueuedThreadPool tp=new QueuedThreadPool(254);
  tp.setName("Jetty-QTP-AdminConsole");
  adminServer.setThreadPool(tp);
  adminServer.setSendServerVersion(false);
  if (adminPort > 0) {
    Connector httpConnector=new SelectChannelConnector();
    String bindInterface=getBindInterface();
    httpConnector.setHost(bindInterface);
    httpConnector.setPort(adminPort);
    adminServer.addConnector(httpConnector);
  }
  sslEnabled=false;
  try {
    if (adminSecurePort > 0 && CertificateManager.isRSACertificate(SSLConfig.getKeyStore(),"*")) {
      if (!CertificateManager.isRSACertificate(SSLConfig.getKeyStore(),XMPPServer.getInstance().getServerInfo().getXMPPDomain())) {
        Log.warn("Admin console: Using RSA certificates but they are not valid for the hosted domain");
      }
      final SslContextFactory sslContextFactory=new SslContextFactory(SSLConfig.getKeystoreLocation());
      sslContextFactory.setTrustStorePassword(SSLConfig.gets2sTrustPassword());
      sslContextFactory.setTrustStoreType(SSLConfig.getStoreType());
      sslContextFactory.setTrustStore(SSLConfig.gets2sTruststoreLocation());
      sslContextFactory.setNeedClientAuth(false);
      sslContextFactory.setWantClientAuth(false);
      sslContextFactory.setKeyStorePassword(SSLConfig.getKeyPassword());
      sslContextFactory.setKeyStoreType(SSLConfig.getStoreType());
      final SslSelectChannelConnector httpsConnector=new SslSelectChannelConnector(sslContextFactory);
      String bindInterface=getBindInterface();
      httpsConnector.setHost(bindInterface);
      httpsConnector.setPort(adminSecurePort);
      adminServer.addConnector(httpsConnector);
      sslEnabled=true;
    }
  }
 catch (  Exception e) {
    Log.error(e.getMessage(),e);
  }
  if (adminServer.getConnectors() == null || adminServer.getConnectors().length == 0) {
    adminServer=null;
    log(LocaleUtils.getLocalizedString("admin.console.warning"));
    return;
  }
  HandlerCollection collection=new HandlerCollection();
  adminServer.setHandler(collection);
  collection.setHandlers(new Handler[]{contexts,new DefaultHandler()});
  try {
    adminServer.start();
  }
 catch (  Exception e) {
    Log.error("Could not start admin conosle server",e);
  }
  logAdminConsolePorts();
}

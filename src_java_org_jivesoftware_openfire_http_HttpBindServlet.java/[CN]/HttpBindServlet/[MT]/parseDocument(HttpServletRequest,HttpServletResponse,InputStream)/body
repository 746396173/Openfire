{
  Document document;
  try {
    document=createDocument(documentContent);
  }
 catch (  Exception e) {
    Log.warn("Error parsing user request. [" + request.getRemoteAddr() + "]");
    sendLegacyError(response,BoshBindingError.badRequest);
    return;
  }
  Element node=document.getRootElement();
  if (node == null || !"body".equals(node.getName())) {
    Log.warn("Body missing from request content. [" + request.getRemoteAddr() + "]");
    sendLegacyError(response,BoshBindingError.badRequest);
    return;
  }
  String sid=node.attributeValue("sid");
  if (sid == null) {
    if (node.elements().size() > 0) {
      Log.warn("Invalid client request; SID is required. [" + request.getRemoteAddr() + "]");
      sendLegacyError(response,BoshBindingError.badRequest);
      return;
    }
 else {
      createNewSession(request,response,node);
    }
  }
 else {
    handleSessionRequest(sid,request,response,node);
  }
}

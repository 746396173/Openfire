{
  Document document;
  try {
    document=createDocument(documentContent);
  }
 catch (  Exception e) {
    Log.warn("Error parsing user request. [" + request.getRemoteAddr() + "]");
    sendLegacyError(response,BoshBindingError.badRequest);
    return;
  }
  System.out.println("HTTP RECV: " + document.asXML());
  Element node=document.getRootElement();
  if (node == null || !"body".equals(node.getName())) {
    Log.warn("Body missing from request content. [" + request.getRemoteAddr() + "]");
    sendLegacyError(response,BoshBindingError.badRequest);
    return;
  }
  String sid=node.attributeValue("sid");
  if (sid == null) {
    createNewSession(request,response,node);
  }
 else {
    handleSessionRequest(sid,request,response,node);
  }
}

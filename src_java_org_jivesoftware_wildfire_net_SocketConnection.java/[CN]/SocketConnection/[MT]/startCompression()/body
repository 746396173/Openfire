{
  compressed=true;
  if (tlsStreamHandler == null) {
    ZOutputStream out=new ZOutputStream(socket.getOutputStream(),JZlib.Z_BEST_COMPRESSION);
    out.setFlushMode(JZlib.Z_PARTIAL_FLUSH);
    writer=new BufferedWriter(new OutputStreamWriter(out,CHARSET));
    xmlSerializer=new XMLSocketWriter(writer,this);
  }
 else {
    ZOutputStream out=new ZOutputStream(tlsStreamHandler.getOutputStream(),JZlib.Z_BEST_COMPRESSION);
    out.setFlushMode(JZlib.Z_PARTIAL_FLUSH);
    writer=new BufferedWriter(new OutputStreamWriter(out,CHARSET));
    xmlSerializer=new XMLSocketWriter(writer,this);
  }
}

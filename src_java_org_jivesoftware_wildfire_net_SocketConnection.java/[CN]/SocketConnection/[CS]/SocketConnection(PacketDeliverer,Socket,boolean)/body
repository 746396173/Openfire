{
  if (socket == null) {
    throw new NullPointerException("Socket channel must be non-null");
  }
  this.secure=isSecure;
  this.socket=socket;
  if (socket.getChannel() != null) {
    writer=Channels.newWriter(socket.getChannel(),CHARSET);
  }
 else {
    writer=new BufferedWriter(new OutputStreamWriter(socket.getOutputStream(),CHARSET));
  }
  this.backupDeliverer=backupDeliverer;
  xmlSerializer=new XMLSocketWriter(writer,this);
  instances.put(this,"");
}

{
  int version=0;
  PreparedStatement pstmt=null;
  try {
    pstmt=con.prepareStatement(CHECK_VERSION);
    pstmt.setString(1,"wildfire");
    ResultSet rs=pstmt.executeQuery();
    rs.next();
    version=rs.getInt(1);
    rs.close();
  }
 catch (  SQLException sqle) {
    try {
      if (pstmt != null) {
        pstmt.close();
      }
      pstmt=con.prepareStatement(CHECK_VERSION_OLD);
      ResultSet rs=pstmt.executeQuery();
      rs.next();
      version=rs.getInt(1);
      rs.close();
    }
 catch (    SQLException sqle2) {
    }
  }
 finally {
    try {
      if (pstmt != null) {
        pstmt.close();
      }
    }
 catch (    Exception e) {
      Log.error(e);
    }
  }
  if (version == DATABASE_VERSION) {
    return false;
  }
  Log.info(LocaleUtils.getLocalizedString("upgrade.database.old_schema"));
  System.out.println(LocaleUtils.getLocalizedString("upgrade.database.old_schema"));
  if (databaseType == DatabaseType.unknown) {
    Log.info(LocaleUtils.getLocalizedString("upgrade.database.unknown_db"));
    System.out.println(LocaleUtils.getLocalizedString("upgrade.database.unknown_db"));
    return false;
  }
 else   if (databaseType == DatabaseType.interbase) {
    Log.info(LocaleUtils.getLocalizedString("upgrade.database.interbase_db"));
    System.out.println(LocaleUtils.getLocalizedString("upgrade.database.interbase_db"));
    return false;
  }
  for (int i=version + 1; i <= DATABASE_VERSION; i++) {
    BufferedReader in=null;
    Statement stmt;
    try {
      String resourceName="/database/upgrade/" + i + "/wildfire_"+ databaseType+ ".sql";
      InputStream resource=DbConnectionManager.class.getResourceAsStream(resourceName);
      if (resource == null) {
        continue;
      }
      in=new BufferedReader(new InputStreamReader(resource));
      boolean done=false;
      while (!done) {
        StringBuilder command=new StringBuilder();
        while (true) {
          String line=in.readLine();
          if (line == null) {
            done=true;
            break;
          }
          if (isSQLCommandPart(line)) {
            command.append(line);
          }
          if (line.endsWith(";")) {
            break;
          }
        }
        if (!done && command != null) {
          stmt=con.createStatement();
          stmt.execute(command.toString());
          stmt.close();
        }
      }
    }
  finally {
      if (in != null) {
        try {
          in.close();
        }
 catch (        Exception e) {
        }
      }
    }
  }
  Log.info(LocaleUtils.getLocalizedString("upgrade.database.success"));
  System.out.println(LocaleUtils.getLocalizedString("upgrade.database.success"));
  return true;
}

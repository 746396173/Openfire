{
  if (serverName.equals(recipient.getDomain()) && recipient.getResource() != null && userManager.isRegisteredUser(recipient.getNode())) {
    Message msg=(Message)packet;
    if (msg.getType().equals(Message.Type.chat)) {
      routingTable.routePacket(recipient.asBareJID(),packet,false);
    }
 else {
      messageStrategy.storeOffline((Message)packet);
    }
  }
 else {
    messageStrategy.storeOffline((Message)packet);
  }
}

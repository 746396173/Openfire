{
  if (packet == null) {
    throw new NullPointerException();
  }
  Session session=sessionManager.getSession(packet.getFrom());
  JID to=packet.getTo();
  if (session != null && to != null && session.getStatus() == Session.STATUS_CONNECTED && !serverName.equals(to.toString())) {
    IQ reply=IQ.createResultIQ(packet);
    reply.setChildElement(packet.getChildElement().createCopy());
    reply.setError(PacketError.Condition.bad_request);
    sessionManager.getSession(packet.getFrom()).process(reply);
    Log.warn("User tried to authenticate with this server using an unknown receipient: " + packet);
  }
 else   if (session == null || session.getStatus() == Session.STATUS_AUTHENTICATED || (isLocalServer(to) && ("jabber:iq:auth".equals(packet.getChildElement().getNamespaceURI()) || "jabber:iq:register".equals(packet.getChildElement().getNamespaceURI()) || "urn:ietf:params:xml:ns:xmpp-bind".equals(packet.getChildElement().getNamespaceURI())))) {
    handle(packet);
  }
 else {
    IQ reply=IQ.createResultIQ(packet);
    reply.setChildElement(packet.getChildElement().createCopy());
    reply.setError(PacketError.Condition.not_authorized);
    sessionManager.getSession(packet.getFrom()).process(reply);
  }
}

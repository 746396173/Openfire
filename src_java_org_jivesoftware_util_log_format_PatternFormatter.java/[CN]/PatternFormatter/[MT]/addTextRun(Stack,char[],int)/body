{
  final PatternRun run=new PatternRun();
  final int start=index;
  boolean escapeMode=false;
  if ('%' == pattern[index])   index++;
  final StringBuffer sb=new StringBuffer();
  while (index < pattern.length && pattern[index] != '%') {
    if (escapeMode) {
      if ('n' == pattern[index])       sb.append(EOL);
 else       if ('t' == pattern[index])       sb.append('\t');
 else       sb.append(pattern[index]);
      escapeMode=false;
    }
 else     if ('\\' == pattern[index])     escapeMode=true;
 else     sb.append(pattern[index]);
    index++;
  }
  run.m_data=sb.toString();
  run.m_type=TYPE_TEXT;
  stack.push(run);
  return index - start;
}

{
  final Stack stack=new Stack();
  final int size=patternString.length();
  final char pattern[]=new char[size];
  int index=0;
  patternString.getChars(0,size,pattern,0);
  while (index < size) {
    if (pattern[index] == '%' && !(index != size - 1 && pattern[index + 1] == '%')) {
      index+=addPatternRun(stack,pattern,index);
    }
 else {
      index+=addTextRun(stack,pattern,index);
    }
  }
  final int elementCount=stack.size();
  m_formatSpecification=new PatternRun[elementCount];
  for (int i=0; i < elementCount; i++) {
    m_formatSpecification[i]=(PatternRun)stack.elementAt(i);
  }
}

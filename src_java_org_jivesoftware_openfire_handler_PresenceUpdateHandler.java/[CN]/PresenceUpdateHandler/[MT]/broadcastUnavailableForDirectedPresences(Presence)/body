{
  if (update.getFrom() == null) {
    return;
  }
  if (localServer.isLocal(update.getFrom())) {
    Map<String,Set<String>> map=directedPresences.remove(update.getFrom().toString());
    if (map != null) {
      for (      String handler : new HashSet<String>(map.keySet())) {
        JID handlerJID=new JID(handler);
        Set<String> jids=map.get(handler);
        if (jids == null) {
          continue;
        }
        for (        String jid : jids) {
          Presence presence=update.createCopy();
          presence.setTo(jid);
          try {
            routingTable.routePacket(handlerJID,presence);
          }
 catch (          UnauthorizedException ue) {
            Log.error(ue);
          }
        }
      }
    }
  }
}

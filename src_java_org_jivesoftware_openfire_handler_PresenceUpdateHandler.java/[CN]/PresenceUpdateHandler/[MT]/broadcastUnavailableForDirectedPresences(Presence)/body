{
  JID from=update.getFrom();
  if (from == null) {
    return;
  }
  if (localServer.isLocal(from)) {
    Collection<DirectedPresence> directedPresences=directedPresencesCache.remove(from.toString());
    if (directedPresences != null) {
      for (      DirectedPresence directedPresence : directedPresences) {
        for (        String receiver : directedPresence.getReceivers()) {
          Presence presence=update.createCopy();
          presence.setTo(receiver);
          routingTable.routePacket(directedPresence.getHandler(),presence,false);
        }
      }
      localDirectedPresences.remove(from.toString());
    }
  }
}

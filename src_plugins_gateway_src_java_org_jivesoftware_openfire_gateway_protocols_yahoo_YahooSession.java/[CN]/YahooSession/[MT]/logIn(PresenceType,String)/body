{
  this.presenceType=presenceType;
  this.verboseStatus=verboseStatus;
  final PresenceType pType=presenceType;
  if (!isLoggedIn() && getLoginStatus() != TransportLoginStatus.LOGGING_IN && loginAttempts <= 3) {
    setLoginStatus(TransportLoginStatus.LOGGING_IN);
    new Thread(){
      public void run(){
        try {
          loginAttempts++;
          yahooSession.setStatus(StatusConstants.STATUS_AVAILABLE);
          yahooSession.login(registration.getUsername(),registration.getPassword());
          setLoginStatus(TransportLoginStatus.LOGGED_IN);
          Presence p=new Presence();
          p.setTo(getJID());
          p.setFrom(getTransport().getJID());
          getTransport().sendPacket(p);
          yahooSession.setStatus(((YahooTransport)getTransport()).convertJabStatusToYahoo(pType));
          getRegistration().setLastLogin(new Date());
          syncUsers();
        }
 catch (        LoginRefusedException e) {
          yahooSession.reset();
          String reason=LocaleUtils.getLocalizedString("gateway.yahoo.loginrefused","gateway");
switch ((int)e.getStatus()) {
case (int)StatusConstants.STATUS_BADUSERNAME:
            reason=LocaleUtils.getLocalizedString("gateway.yahoo.unknownuser","gateway");
          break;
case (int)StatusConstants.STATUS_BAD:
        reason=LocaleUtils.getLocalizedString("gateway.yahoo.badpassword","gateway");
      break;
case (int)StatusConstants.STATUS_LOCKED:
    AccountLockedException e2=(AccountLockedException)e;
  if (e2.getWebPage() != null) {
    reason=LocaleUtils.getLocalizedString("gateway.yahoo.accountlockedwithurl","gateway",Arrays.asList(e2.getWebPage().toString()));
  }
 else {
    reason=LocaleUtils.getLocalizedString("gateway.yahoo.accountlocked","gateway");
  }
break;
}
Log.warn("Yahoo login failed for " + getJID() + ": "+ reason);
getTransport().sendMessage(getJID(),getTransport().getJID(),reason,Message.Type.error);
setLoginStatus(TransportLoginStatus.LOGGED_OUT);
}
catch (IOException e) {
Log.error("Yahoo login caused IO exception:",e);
getTransport().sendMessage(getJID(),getTransport().getJID(),LocaleUtils.getLocalizedString("gateway.yahoo.unknownerror","gateway"),Message.Type.error);
setLoginStatus(TransportLoginStatus.LOGGED_OUT);
}
}
}
.start();
}
}

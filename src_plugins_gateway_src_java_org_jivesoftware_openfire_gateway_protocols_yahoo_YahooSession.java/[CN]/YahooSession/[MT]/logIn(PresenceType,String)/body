{
  this.presenceType=presenceType;
  this.verboseStatus=verboseStatus;
  final PresenceType pType=presenceType;
  if (!isLoggedIn()) {
    new Thread(){
      public void run(){
        try {
          yahooSession.setStatus(Status.AVAILABLE);
          yahooSession.login(registration.getUsername(),registration.getPassword());
          setLoginStatus(TransportLoginStatus.LOGGED_IN);
          Presence p=new Presence();
          p.setTo(getJID());
          p.setFrom(getTransport().getJID());
          getTransport().sendPacket(p);
          yahooSession.setStatus(((YahooTransport)getTransport()).convertJabStatusToYahoo(pType));
          getRegistration().setLastLogin(new Date());
          syncUsers();
        }
 catch (        LoginRefusedException e) {
          yahooSession.reset();
          String reason=LocaleUtils.getLocalizedString("gateway.yahoo.loginrefused","gateway");
          AuthenticationState state=e.getStatus();
          if (state.equals(AuthenticationState.BADUSERNAME)) {
            reason=LocaleUtils.getLocalizedString("gateway.yahoo.unknownuser","gateway");
          }
 else           if (state.equals(AuthenticationState.BAD)) {
            reason=LocaleUtils.getLocalizedString("gateway.yahoo.badpassword","gateway");
          }
 else           if (state.equals(AuthenticationState.LOCKED)) {
            AccountLockedException e2=(AccountLockedException)e;
            if (e2.getWebPage() != null) {
              reason=LocaleUtils.getLocalizedString("gateway.yahoo.accountlockedwithurl","gateway",Arrays.asList(e2.getWebPage().toString()));
            }
 else {
              reason=LocaleUtils.getLocalizedString("gateway.yahoo.accountlocked","gateway");
            }
          }
          Log.warn("Yahoo login failed for " + getJID() + ": "+ reason);
          getTransport().sendMessage(getJID(),getTransport().getJID(),reason,Message.Type.error);
          setLoginStatus(TransportLoginStatus.LOGGED_OUT);
        }
catch (        IOException e) {
          Log.error("Yahoo login caused IO exception:",e);
          getTransport().sendMessage(getJID(),getTransport().getJID(),LocaleUtils.getLocalizedString("gateway.yahoo.unknownerror","gateway"),Message.Type.error);
          setLoginStatus(TransportLoginStatus.LOGGED_OUT);
        }
      }
    }
.start();
  }
}

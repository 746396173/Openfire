{
  Log.debug("Received message packet: " + packet.toXML());
  List<Packet> reply=new ArrayList<Packet>();
  JID from=packet.getFrom();
  JID to=packet.getTo();
  try {
    TransportSession session=sessionManager.getSession(from);
    if (!session.isLoggedIn()) {
      Message m=new Message();
      m.setError(Condition.service_unavailable);
      m.setTo(from);
      m.setFrom(getJID());
      m.setBody("You are not currently logged into the transport.");
      reply.add(m);
    }
 else     if (to.getNode() == null) {
      if (packet.getBody() != null) {
        session.sendServerMessage(packet.getBody());
      }
    }
 else {
      if (packet.getBody() != null) {
        session.sendMessage(to,packet.getBody());
      }
    }
  }
 catch (  NotFoundException e) {
    Log.debug("Unable to find session.");
  }
  return reply;
}

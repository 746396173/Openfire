{
  try {
    Roster roster=rosterManager.getRoster(userjid.getNode());
    try {
      RosterItem gwitem=roster.getRosterItem(contactjid);
      if (gwitem.getSubStatus() != RosterItem.SUB_BOTH) {
        gwitem.setSubStatus(RosterItem.SUB_BOTH);
      }
      if (gwitem.getAskStatus() != RosterItem.ASK_NONE) {
        gwitem.setAskStatus(RosterItem.ASK_NONE);
      }
      gwitem.setNickname(nickname);
      List<String> groups=new ArrayList<String>();
      groups.add(group);
      try {
        gwitem.setGroups(groups);
      }
 catch (      Exception ee) {
      }
      roster.updateRosterItem(gwitem);
    }
 catch (    UserNotFoundException e) {
      try {
        RosterItem gwitem=roster.createRosterItem(contactjid,true);
        gwitem.setSubStatus(RosterItem.SUB_BOTH);
        gwitem.setAskStatus(RosterItem.ASK_NONE);
        gwitem.setNickname(nickname);
        List<String> groups=new ArrayList<String>();
        groups.add(group);
        try {
          gwitem.setGroups(groups);
        }
 catch (        Exception ee) {
        }
        roster.updateRosterItem(gwitem);
      }
 catch (      UserAlreadyExistsException ee) {
        Log.error("getRosterItem claims user exists, but couldn't find via getRosterItem?");
      }
catch (      Exception ee) {
        Log.error("createRosterItem caused exception: " + ee.getMessage());
      }
    }
  }
 catch (  UserNotFoundException e) {
    throw new UserNotFoundException("Could not find roster for " + userjid.toString());
  }
}

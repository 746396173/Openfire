{
  if (!XMPPServer.getInstance().getServerInfo().getName().equals(jid.getDomain())) {
    throw new IllegalAccessException("Domain of jid registering does not match domain of server.");
  }
  Collection<Registration> registrations=registrationManager.getRegistrations(jid,this.transportType);
  Boolean foundReg=false;
  for (  Registration registration : registrations) {
    if (!registration.getUsername().equals(username)) {
      registrationManager.deleteRegistration(registration);
    }
 else {
      registration.setPassword(password);
      foundReg=true;
    }
  }
  if (!foundReg) {
    registrationManager.createRegistration(jid,this.transportType,username,password,nickname);
  }
  try {
    cleanUpRoster(jid,true);
  }
 catch (  UserNotFoundException ee) {
    throw new UserNotFoundException("Unable to find roster.");
  }
  try {
    addOrUpdateRosterItem(jid,this.getJID(),this.getDescription(),"Transports");
  }
 catch (  UserNotFoundException e) {
    throw new UserNotFoundException("User not registered with server.");
  }
}

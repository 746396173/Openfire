{
  if (lastPresenceSent == null) {
    logger.error("No presence packet obtained yet");
    return;
  }
  XmppProtocolProvider xmppProtocolProvider=(XmppProtocolProvider)getParentProvider();
  PacketExtension old=lastPresenceSent.getExtension(extension.getElementName(),extension.getNamespace());
  if (old != null) {
    lastPresenceSent.removeExtension(old);
  }
  lastPresenceSent.addExtension(extension);
  XmppConnection connection=xmppProtocolProvider.getConnectionAdapter();
  if (connection == null) {
    logger.error("Failed to send presence extension - no connection");
    return;
  }
  connection.sendPacket(lastPresenceSent);
}

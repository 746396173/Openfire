{
  String participant=presence.getFrom();
  ChatMemberImpl member=members.get(presence.getFrom());
  if (member == null) {
    logger.warn("Received presence for non-existing member: " + presence.toXML());
    if (earlyParticipant.contains(participant)) {
      earlyParticipant.remove(participant);
      member=addMember(participant);
      if (member != null) {
        member.processPresence(presence);
        notifyParticipantJoined(member);
      }
    }
 else {
      onJoinPresence.put(presence.getFrom(),presence);
    }
    return;
  }
  member.processPresence(presence);
}

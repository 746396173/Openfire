{
  if (rosterItems.putIfAbsent(item.getJid().toBareJID(),item) == null) {
    rosterItems.remove(item.getJid().toBareJID());
    if (item.getSubStatus() != RosterItem.SUB_NONE) {
      throw new UserNotFoundException(item.getJid().toBareJID());
    }
    return;
  }
  if (item.isShared() && item.getID() == 0) {
    if (item.isOnlyShared()) {
      String defaultContactName;
      try {
        defaultContactName=UserNameManager.getUserName(item.getJid());
      }
 catch (      UserNotFoundException e) {
        defaultContactName=item.getNickname();
      }
      if (defaultContactName.equals(item.getNickname())) {
        return;
      }
    }
    try {
      rosterItemProvider.createItem(username,item);
    }
 catch (    UserAlreadyExistsException e) {
    }
  }
 else {
    rosterItemProvider.updateItem(username,item);
  }
  if (item.getSubStatus() != RosterItem.SUB_NONE || item.getAskStatus() != RosterItem.ASK_SUBSCRIBE) {
    broadcast(item,true);
  }
}

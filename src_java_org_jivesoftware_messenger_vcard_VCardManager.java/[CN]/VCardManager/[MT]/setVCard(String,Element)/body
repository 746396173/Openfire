{
  if (provider.isReadOnly()) {
    throw new UnsupportedOperationException("VCard provider is read-only.");
  }
  Element oldVCard=getOrLoadVCard(username);
  if (oldVCard != null) {
    if (!oldVCard.equals(vCardElement)) {
      try {
        provider.updateVCard(username,vCardElement);
      }
 catch (      NotFoundException e) {
        Log.warn("Tried to update a vCard that does not exist",e);
        provider.createVCard(username,vCardElement);
      }
    }
  }
 else {
    try {
      provider.createVCard(username,vCardElement);
    }
 catch (    AlreadyExistsException e) {
      Log.warn("Tried to create a vCard when one already exist",e);
      provider.updateVCard(username,vCardElement);
    }
  }
  vcardCache.put(username,vCardElement);
}

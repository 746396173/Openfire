{
  XDataFormImpl searchResults=new XDataFormImpl(DataForm.TYPE_RESULT);
  XFormFieldImpl field=new XFormFieldImpl("FORM_TYPE");
  field.setType(FormField.TYPE_HIDDEN);
  searchResults.addField(field);
  field=new XFormFieldImpl("jid");
  field.setLabel("JID");
  searchResults.addReportedField(field);
  for (  String fieldName : searchFields) {
    field=new XFormFieldImpl(fieldName);
    field.setLabel(fieldName);
    searchResults.addReportedField(field);
  }
  for (  User user : users) {
    String username=user.getUsername();
    ArrayList<XFormFieldImpl> items=new ArrayList<XFormFieldImpl>();
    XFormFieldImpl fieldJID=new XFormFieldImpl("jid");
    fieldJID.addValue(username + "@" + serverName);
    items.add(fieldJID);
    XFormFieldImpl fieldUsername=new XFormFieldImpl("Username");
    fieldUsername.addValue(username);
    items.add(fieldUsername);
    XFormFieldImpl fieldName=new XFormFieldImpl("Name");
    fieldName.addValue(removeNull(user.getName()));
    items.add(fieldName);
    XFormFieldImpl fieldEmail=new XFormFieldImpl("Email");
    fieldEmail.addValue(removeNull(user.getEmail()));
    items.add(fieldEmail);
    searchResults.addItemFields(items);
  }
  Element reply=DocumentHelper.createElement(QName.get("query","jabber:iq:search"));
  reply.add(searchResults.asXMLElement());
  IQ replyPacket=IQ.createResultIQ(packet);
  replyPacket.setChildElement(reply);
  return replyPacket;
}

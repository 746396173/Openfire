def _AddWinLinkRules(master_ninja, embed_manifest, link_incremental):
    'Adds link rules for Windows platform to |master_ninja|.'

    def FullLinkCommand(ldcmd, out, binary_type):
        cmd = 'cmd /c %(ldcmd)s && %(python)s gyp-win-tool manifest-wrapper $arch cmd /c if exist %(out)s.manifest del %(out)s.manifest && %(python)s gyp-win-tool manifest-wrapper $arch $mt -nologo -manifest $manifests'
        if (embed_manifest and (not link_incremental)):
            cmd += ' -outputresource:%(out)s;%(resname)s'
        else:
            cmd += ' -out:%(out)s.manifest'
        if link_incremental:
            assert embed_manifest
            cmd += ' && %(python)s gyp-win-tool manifest-to-rc $arch %(out)s.manifest %(out)s.manifest.rc %(resname)s && %(python)s gyp-win-tool rc-wrapper $arch $rc %(out)s.manifest.rc && %(ldcmd)s %(out)s.manifest.res'
        resource_name = {'exe': '1', 'dll': '2', }[binary_type]
        return (cmd % {'python': sys.executable, 'out': out, 'ldcmd': ldcmd, 'resname': resource_name, })
    rule_name_suffix = _GetWinLinkRuleNameSuffix(embed_manifest, link_incremental)
    dlldesc = ('LINK%s(DLL) $dll' % rule_name_suffix.upper())
    dllcmd = ('%s gyp-win-tool link-wrapper $arch $ld /nologo $implibflag /DLL /OUT:$dll /PDB:$dll.pdb @$dll.rsp' % sys.executable)
    dllcmd = FullLinkCommand(dllcmd, '$dll', 'dll')
    master_ninja.rule(('solink' + rule_name_suffix), description=dlldesc, command=dllcmd, rspfile='$dll.rsp', rspfile_content='$libs $in_newline $ldflags', restat=True, pool='link_pool')
    master_ninja.rule(('solink_module' + rule_name_suffix), description=dlldesc, command=dllcmd, rspfile='$dll.rsp', rspfile_content='$libs $in_newline $ldflags', restat=True, pool='link_pool')
    exe_cmd = ('%s gyp-win-tool link-wrapper $arch $ld /nologo /OUT:$out /PDB:$out.pdb @$out.rsp' % sys.executable)
    exe_cmd = FullLinkCommand(exe_cmd, '$out', 'exe')
    master_ninja.rule(('link' + rule_name_suffix), description=('LINK%s $out' % rule_name_suffix.upper()), command=exe_cmd, rspfile='$out.rsp', rspfile_content='$in_newline $libs $ldflags', pool='link_pool')

{
  if (packet == null) {
    throw new NullPointerException();
  }
  ClientSession session=sessionManager.getSession(packet.getFrom());
  if (session == null || session.getStatus() == Session.STATUS_AUTHENTICATED) {
    handle(packet);
  }
 else {
    packet.setTo(session.getAddress());
    packet.setFrom((JID)null);
    packet.setError(PacketError.Condition.not_authorized);
    session.process(packet);
  }
}

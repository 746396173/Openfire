{
  SnacCommand cmd=e.getSnacCommand();
  if (cmd instanceof ServerReadyCmd) {
    ServerReadyCmd src=(ServerReadyCmd)cmd;
    setSnacFamilies(src.getSnacFamilies());
    SnacFamilyInfo[] familyInfos=SnacFamilyInfoFactory.getDefaultFamilyInfos(src.getSnacFamilies());
    setSnacFamilyInfos(familyInfos);
    oscarSession.registerSnacFamilies(this);
    request(new ClientVersionsCmd(familyInfos));
    request(new RateInfoRequest());
  }
 else   if (cmd instanceof RecvImIcbm) {
    RecvImIcbm icbm=(RecvImIcbm)cmd;
    String sn=icbm.getSenderInfo().getScreenname();
    InstantMessage message=icbm.getMessage();
    String msg=OscarTools.stripHtml(message.getMessage());
    Message m=new Message();
    m.setTo(oscarSession.getJIDWithHighestPriority());
    m.setBody(msg);
    m.setType(Message.Type.chat);
    m.setFrom(this.oscarSession.getTransport().convertIDToJID(sn));
    oscarSession.getTransport().sendPacket(m);
  }
 else   if (cmd instanceof WarningNotification) {
    WarningNotification wn=(WarningNotification)cmd;
    MiniUserInfo warner=wn.getWarner();
    if (warner == null) {
      Message m=new Message();
      m.setTo(oscarSession.getJIDWithHighestPriority());
      m.setBody("You have received an anonymous AIM warning.  Your warning level is now " + wn.getNewLevel() + "%.");
      m.setType(Message.Type.headline);
      m.setFrom(this.oscarSession.getTransport().getJID());
      oscarSession.getTransport().sendPacket(m);
    }
 else {
      Log.debug("*** " + warner.getScreenname() + " warned you up to "+ wn.getNewLevel()+ "%");
      Message m=new Message();
      m.setTo(oscarSession.getJIDWithHighestPriority());
      m.setBody("You have received an AIM warning from " + warner.getScreenname() + ".  Your warning level is now "+ wn.getNewLevel()+ "%.");
      m.setType(Message.Type.headline);
      m.setFrom(this.oscarSession.getTransport().getJID());
      oscarSession.getTransport().sendPacket(m);
    }
  }
 else   if (cmd instanceof BuddyStatusCmd) {
    BuddyStatusCmd bsc=(BuddyStatusCmd)cmd;
    FullUserInfo info=bsc.getUserInfo();
    buddystore.put(info.getScreenname(),info);
    Presence p=new Presence();
    p.setTo(oscarSession.getJID());
    p.setFrom(oscarSession.getTransport().convertIDToJID(info.getScreenname()));
    if (info.getAwayStatus()) {
      p.setShow(Presence.Show.away);
    }
    ExtraInfoBlock[] extraInfo=info.getExtraInfoBlocks();
    if (extraInfo != null) {
      for (      ExtraInfoBlock i : extraInfo) {
        ExtraInfoData data=i.getExtraData();
        if (i.getType() == ExtraInfoBlock.TYPE_AVAILMSG) {
          ByteBlock msgBlock=data.getData();
          int len=BinaryTools.getUShort(msgBlock,0);
          byte[] msgBytes=msgBlock.subBlock(2,len).toByteArray();
          String msg;
          try {
            msg=new String(msgBytes,"UTF-8");
          }
 catch (          UnsupportedEncodingException e1) {
            continue;
          }
          if (msg.length() > 0) {
            p.setStatus(msg);
          }
        }
      }
    }
    oscarSession.getTransport().sendPacket(p);
  }
 else   if (cmd instanceof BuddyOfflineCmd) {
    BuddyOfflineCmd boc=(BuddyOfflineCmd)cmd;
    buddystore.remove(boc.getScreenname());
    Presence p=new Presence(Presence.Type.unavailable);
    p.setTo(oscarSession.getJID());
    p.setFrom(oscarSession.getTransport().convertIDToJID(boc.getScreenname()));
    oscarSession.getTransport().sendPacket(p);
  }
 else   if (cmd instanceof RateChange) {
  }
}

{
  Log.debug("OSCAR snac packet received: " + e);
  SnacCommand cmd=e.getSnacCommand();
  if (cmd instanceof ServerReadyCmd) {
    ServerReadyCmd src=(ServerReadyCmd)cmd;
    setSnacFamilies(src.getSnacFamilies());
    Collection<SnacFamilyInfo> familyInfos=SnacFamilyInfoFactory.getDefaultFamilyInfos(src.getSnacFamilies());
    setSnacFamilyInfos(familyInfos);
    oscarSession.registerSnacFamilies(this);
    request(new ClientVersionsCmd(familyInfos));
    request(new RateInfoRequest());
  }
 else   if (cmd instanceof RecvImIcbm) {
    RecvImIcbm icbm=(RecvImIcbm)cmd;
    String sn=icbm.getSenderInfo().getScreenname();
    InstantMessage message=icbm.getMessage();
    String msg=OscarTools.stripHtml(message.getMessage());
    oscarSession.getTransport().sendMessage(oscarSession.getJIDWithHighestPriority(),oscarSession.getTransport().convertIDToJID(sn),msg);
  }
 else   if (cmd instanceof WarningNotification) {
    WarningNotification wn=(WarningNotification)cmd;
    MiniUserInfo warner=wn.getWarner();
    if (warner == null) {
      oscarSession.getTransport().sendMessage(oscarSession.getJIDWithHighestPriority(),oscarSession.getTransport().getJID(),"You have received an anonymous AIM warning.  Your warning level is now " + wn.getNewLevel() + "%.",Message.Type.headline);
    }
 else {
      Log.debug("*** " + warner.getScreenname() + " warned you up to "+ wn.getNewLevel()+ "%");
      oscarSession.getTransport().sendMessage(oscarSession.getJIDWithHighestPriority(),oscarSession.getTransport().getJID(),"You have received an AIM warning from " + warner.getScreenname() + ".  Your warning level is now "+ wn.getNewLevel()+ "%.",Message.Type.headline);
    }
  }
 else   if (cmd instanceof BuddyStatusCmd) {
    BuddyStatusCmd bsc=(BuddyStatusCmd)cmd;
    FullUserInfo info=bsc.getUserInfo();
    buddystore.put(info.getScreenname(),info);
    Presence p=new Presence();
    p.setTo(oscarSession.getJID());
    p.setFrom(oscarSession.getTransport().convertIDToJID(info.getScreenname()));
    if (info.getAwayStatus()) {
      p.setShow(Presence.Show.away);
    }
    List<ExtraInfoBlock> extraInfo=info.getExtraInfoBlocks();
    if (extraInfo != null) {
      for (      ExtraInfoBlock i : extraInfo) {
        ExtraInfoData data=i.getExtraData();
        if (i.getType() == ExtraInfoBlock.TYPE_AVAILMSG) {
          String msg=ExtraInfoData.readAvailableMessage(data);
          if (msg.length() > 0) {
            p.setStatus(msg);
          }
        }
      }
    }
    oscarSession.getTransport().sendPacket(p);
  }
 else   if (cmd instanceof BuddyOfflineCmd) {
    BuddyOfflineCmd boc=(BuddyOfflineCmd)cmd;
    buddystore.remove(boc.getScreenname());
    Presence p=new Presence(Presence.Type.unavailable);
    p.setTo(oscarSession.getJID());
    p.setFrom(oscarSession.getTransport().convertIDToJID(boc.getScreenname()));
    oscarSession.getTransport().sendPacket(p);
  }
 else   if (cmd instanceof TypingCmd) {
    TypingCmd tc=(TypingCmd)cmd;
    String sn=tc.getScreenname();
    if (tc.getTypingState() == TypingCmd.STATE_TYPING) {
      oscarSession.getTransport().sendComposingNotification(oscarSession.getJIDWithHighestPriority(),oscarSession.getTransport().convertIDToJID(sn));
    }
 else     if (tc.getTypingState() == TypingCmd.STATE_PAUSED) {
      oscarSession.getTransport().sendComposingPausedNotification(oscarSession.getJIDWithHighestPriority(),oscarSession.getTransport().convertIDToJID(sn));
    }
 else     if (tc.getTypingState() == TypingCmd.STATE_NO_TEXT) {
      oscarSession.getTransport().sendChatInactiveNotification(oscarSession.getJIDWithHighestPriority(),oscarSession.getTransport().convertIDToJID(sn));
    }
  }
}

{
  XmlPullParser xpp=reader.getXPPParser();
  if (connection.getTLSStreamHandler() == null) {
    xpp.setInput(new InputStreamReader(socket.getInputStream(),CHARSET));
  }
 else {
    xpp.setInput(new InputStreamReader(connection.getTLSStreamHandler().getInputStream(),CHARSET));
  }
  for (int eventType=xpp.getEventType(); eventType != XmlPullParser.START_TAG; ) {
    eventType=xpp.next();
  }
  StringBuilder sb=new StringBuilder(420);
  sb.append(geStreamHeader());
  sb.append("<stream:features>");
  String specificFeatures=session.getAvailableStreamFeatures();
  if (specificFeatures != null) {
    sb.append(specificFeatures);
  }
  sb.append("</stream:features>");
  connection.deliverRawText(sb.toString());
}

{
  if (username == null || token == null || digest == null) {
    throw new UnauthorizedException();
  }
  username=username.trim().toLowerCase();
  try {
    String password=getPassword(username);
    String anticipatedDigest=AuthFactory.createDigest(token,password);
    if (!digest.equalsIgnoreCase(anticipatedDigest)) {
      throw new UnauthorizedException();
    }
  }
 catch (  UserNotFoundException unfe) {
    throw new UnauthorizedException();
  }
}

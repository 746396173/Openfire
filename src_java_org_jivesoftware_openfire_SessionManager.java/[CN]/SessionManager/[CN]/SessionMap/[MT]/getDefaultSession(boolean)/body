{
  if (priorityList.isEmpty()) {
    return null;
  }
  if (!filterAvailable) {
    ClientSession session=resources.get(priorityList.getFirst());
    if (session.getPresence().getPriority() >= 0) {
      return session;
    }
    return null;
  }
 else {
synchronized (priorityList) {
      for (      String resource : priorityList) {
        ClientSession s=resources.get(resource);
        if (s != null && s.getPresence().isAvailable()) {
          if (s.getPresence().getPriority() >= 0) {
            return s;
          }
        }
      }
    }
    return null;
  }
}

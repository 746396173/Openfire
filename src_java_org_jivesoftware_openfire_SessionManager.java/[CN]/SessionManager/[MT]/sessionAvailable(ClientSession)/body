{
  if (anonymousSessions.containsValue(session)) {
    routingTable.addRoute(session.getAddress(),session);
  }
 else {
    Session defaultSession;
    try {
      SessionMap sessionMap=sessions.get(session.getUsername());
      if (sessionMap == null) {
        Log.warn("No SessionMap found for session" + "\n" + session);
        return;
      }
      sessionMap.sessionAvailable(session);
      defaultSession=sessionMap.getDefaultSession(true);
      if (defaultSession != null) {
        JID node=new JID(session.getAddress().getNode(),session.getAddress().getDomain(),null);
        routingTable.addRoute(node,defaultSession);
      }
      routingTable.addRoute(session.getAddress(),session);
      broadcastPresenceOfOtherResource(session);
    }
 catch (    UserNotFoundException e) {
    }
  }
}

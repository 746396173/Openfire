{
  if (session.getAddress() != null && routingTable != null && session.getAddress().toBareJID().trim().length() != 0) {
    routingTable.addClientRoute(session.getAddress(),session);
    try {
      if (session.getUsername() == null) {
        return;
      }
      SessionMap sessionMap=sessions.get(session.getUsername());
      if (sessionMap == null) {
        JID userJID=new JID(session.getUsername(),serverName,"",true);
        if (routingTable.hasClientRoute(userJID)) {
          routingTable.removeClientRoute(new JID(session.getAddress().getNode(),session.getAddress().getDomain(),"",true));
        }
      }
 else       if (sessionMap.getAvailableSessions().isEmpty()) {
        routingTable.removeClientRoute(new JID(session.getAddress().getNode(),session.getAddress().getDomain(),"",true));
      }
 else {
        sessionMap.sessionUnavailable(session);
        ClientSession defaultSession=sessionMap.getDefaultSession(true);
        JID jid=new JID(session.getAddress().getNode(),session.getAddress().getDomain(),"",true);
        if (defaultSession != null) {
          routingTable.addClientRoute(jid,defaultSession);
        }
 else {
          routingTable.removeClientRoute(jid);
        }
      }
    }
 catch (    UserNotFoundException e) {
    }
  }
}

{
  final ConnectionType connectionType=isS2S ? ConnectionType.SOCKET_S2S : ConnectionType.SOCKET_C2S;
  final KeyStore keyStore=CertificateStoreManager.getIdentityStore(connectionType).getStore();
  final KeyStore trustStore=CertificateStoreManager.getTrustStore(connectionType).getStore();
  final X509Certificate trusted=CertificateManager.getEndEntityCertificate(chain,keyStore,trustStore);
  if (trusted != null) {
    return verifyCertificate(trusted,hostname);
  }
  return false;
}

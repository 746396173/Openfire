{
  final Purpose purpose=isS2S ? Purpose.SOCKET_S2S : Purpose.SOCKET_C2S;
  final KeyStore keyStore=SSLConfig.getIdentityStore(purpose);
  final KeyStore trustStore=SSLConfig.getTrustStore(purpose);
  final X509Certificate trusted=CertificateManager.getEndEntityCertificate(chain,keyStore,trustStore);
  if (trusted != null) {
    return verifyCertificate(trusted,hostname);
  }
  return false;
}

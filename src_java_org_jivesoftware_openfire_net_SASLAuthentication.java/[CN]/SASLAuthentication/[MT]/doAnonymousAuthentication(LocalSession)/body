{
  if (XMPPServer.getInstance().getIQAuthHandler().isAnonymousAllowed()) {
    boolean forbidAccess=!LocalClientSession.isAllowedAnonymous(session.getConnection());
    if (forbidAccess) {
      authenticationFailed(session,Failure.NOT_AUTHORIZED);
      return Status.failed;
    }
    authenticationSuccessful(session,null,null);
    return Status.authenticated;
  }
 else {
    authenticationFailed(session,Failure.NOT_AUTHORIZED);
    return Status.failed;
  }
}

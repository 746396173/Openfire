{
  String secretDigest;
  String response=doc.getTextTrim();
  if (response == null || response.length() == 0) {
    sendChallenge(session,new byte[0]);
    return Status.needResponse;
  }
  String data=new String(StringUtils.decodeBase64(response),StandardCharsets.UTF_8);
  StringTokenizer tokens=new StringTokenizer(data,"\0");
  tokens.nextToken();
  secretDigest=tokens.nextToken();
  if (authenticateSharedSecret(secretDigest)) {
    authenticationSuccessful(session,null,null);
    return Status.authenticated;
  }
  authenticationFailed(session,Failure.NOT_AUTHORIZED);
  return Status.failed;
}

{
  Set<String> answer=new HashSet<>(mechanisms);
  for (Iterator<String> it=answer.iterator(); it.hasNext(); ) {
    String mech=it.next();
    if (mech.equals("CRAM-MD5") || mech.equals("DIGEST-MD5")) {
      if (!AuthFactory.supportsPasswordRetrieval()) {
        it.remove();
      }
    }
 else     if (mech.equals("SCRAM-SHA-1")) {
      if (!AuthFactory.supportsPasswordRetrieval() && !AuthFactory.supportsScram()) {
        it.remove();
      }
    }
 else     if (mech.equals("ANONYMOUS")) {
      if (!JiveGlobals.getBooleanProperty("xmpp.auth.anonymous")) {
        it.remove();
      }
    }
 else     if (mech.equals("JIVE-SHAREDSECRET")) {
      if (!JiveSharedSecretSaslServer.isSharedSecretAllowed()) {
        it.remove();
      }
    }
 else     if (mech.equals("GSSAPI")) {
      final String gssapiConfig=JiveGlobals.getProperty("sasl.gssapi.config");
      if (gssapiConfig != null) {
        System.setProperty("java.security.krb5.debug",JiveGlobals.getProperty("sasl.gssapi.debug","false"));
        System.setProperty("java.security.auth.login.config",gssapiConfig);
        System.setProperty("javax.security.auth.useSubjectCredsOnly",JiveGlobals.getProperty("sasl.gssapi.useSubjectCredsOnly","false"));
      }
 else {
        it.remove();
      }
    }
  }
  return answer;
}

{
  List<User> userList=new ArrayList<>();
  boolean isUnsupported=false;
  for (  UserProvider provider : userproviders) {
    Set<String> validFields=provider.getSearchFields();
    for (    String field : fields) {
      if (!validFields.contains(field)) {
        continue;
      }
    }
    try {
      userList.addAll(provider.findUsers(fields,query));
    }
 catch (    UnsupportedOperationException uoe) {
      Log.warn("UserProvider.findUsers is not supported by this UserProvider: " + provider.getClass().getName());
      isUnsupported=true;
    }
  }
  if (isUnsupported && userList.size() == 0) {
    throw new UnsupportedOperationException();
  }
  return userList;
}

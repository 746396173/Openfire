{
  Collection<String> users=getAffectedUsers(group);
  Roster addedUserRoster=(Roster)CacheManager.getCache("username2roster").get(addedUser);
  for (  String userToUpdate : users) {
    if (!addedUser.equals(userToUpdate)) {
      Roster roster=(Roster)CacheManager.getCache("username2roster").get(userToUpdate);
      if (roster != null) {
        roster.addSharedUser(group,addedUser);
      }
      if (addedUserRoster != null) {
        try {
          User user=UserManager.getInstance().getUser(userToUpdate);
          Collection<Group> groups=GroupManager.getInstance().getGroups(user);
          addedUserRoster.addSharedUser(userToUpdate,groups,group);
        }
 catch (        UserNotFoundException e) {
        }
      }
    }
  }
}

{
  Collection<String> users=getRelatedUsers(group,true);
  Roster addedUserRoster=(Roster)CacheManager.getCache("username2roster").get(addedUser);
  for (  String userToUpdate : users) {
    if (!addedUser.equals(userToUpdate)) {
      Roster roster=(Roster)CacheManager.getCache("username2roster").get(userToUpdate);
      if (roster != null) {
        roster.addSharedUser(group,addedUser);
      }
      if (addedUserRoster != null && group.isUser(userToUpdate)) {
        addedUserRoster.addSharedUser(group,userToUpdate);
      }
    }
  }
}

{
  Log.debug("IRC disconnected");
  if (getSession().getTransport().getLegacyMode()) {
    Presence p=new Presence(Presence.Type.unavailable);
    p.setTo(getSession().getJID());
    p.setFrom(getSession().getTransport().getJID());
    getSession().getTransport().sendPacket(p);
  }
  getSession().getConnection().close();
  timer.cancel();
  getSession().setLoginStatus(TransportLoginStatus.LOGGED_OUT);
}

{
  if (!(session instanceof IncomingServerSession)) {
    return Status.failed;
  }
  String hostname=doc.getTextTrim();
  if (hostname == null || hostname.length() == 0) {
    sendChallenge(session,new byte[0]);
    return Status.needResponse;
  }
  hostname=new String(StringUtils.decodeBase64(hostname),CHARSET);
  boolean verify=JiveGlobals.getBooleanProperty("xmpp.server.certificate.verify",true);
  if (!verify) {
    authenticationSuccessful(session,hostname,null);
    return Status.authenticated;
  }
  SocketConnection connection=(SocketConnection)session.getConnection();
  try {
    for (    Certificate certificate : connection.getSSLSession().getPeerCertificates()) {
      if (TLSStreamHandler.getPeerIdentities((X509Certificate)certificate).contains(hostname)) {
        authenticationSuccessful(session,hostname,null);
        return Status.authenticated;
      }
    }
  }
 catch (  SSLPeerUnverifiedException e) {
    Log.warn("Error retrieving client certificates of: " + session,e);
  }
  authenticationFailed(session);
  return Status.failed;
}

{
  if (!(session instanceof IncomingServerSession)) {
    return false;
  }
  String hostname=doc.getTextTrim();
  if (hostname == null || hostname.length() == 0) {
    sendChallenge(new byte[0]);
    doc=reader.parseDocument().getRootElement();
    if (doc != null && doc.getTextTrim().length() > 0) {
      hostname=doc.getTextTrim();
    }
  }
  if (hostname != null && hostname.length() > 0) {
    hostname=new String(StringUtils.decodeBase64(hostname),CHARSET);
    if (session instanceof IncomingServerSession) {
      boolean verify=JiveGlobals.getBooleanProperty("xmpp.server.certificate.verify",true);
      if (!verify) {
        authenticationSuccessful(hostname);
        return true;
      }
    }
    for (    Certificate certificate : connection.getSSLSession().getPeerCertificates()) {
      if (TLSStreamHandler.getPeerIdentities((X509Certificate)certificate).contains(hostname)) {
        authenticationSuccessful(hostname);
        return true;
      }
    }
  }
  authenticationFailed();
  return false;
}

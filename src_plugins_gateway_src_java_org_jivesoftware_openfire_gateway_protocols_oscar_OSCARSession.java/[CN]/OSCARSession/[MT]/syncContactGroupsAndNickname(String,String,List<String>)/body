{
  if (grouplist.isEmpty()) {
    if (transport.getType().equals(TransportType.icq)) {
      grouplist.add(DEFAULT_ICQ_GROUP);
    }
 else {
      grouplist.add(DEFAULT_AIM_GROUP);
    }
  }
  Log.debug("contact = " + contact + ", grouplist = "+ grouplist);
  for (  String group : grouplist) {
    Integer groupId=getGroupIdOrCreateNew(group);
    Integer newBuddyId=1;
    if (highestBuddyIdPerGroup.containsKey(groupId)) {
      newBuddyId=highestBuddyIdPerGroup.get(groupId) + 1;
    }
    BuddyItem newBuddy=new BuddyItem(contact,groupId,newBuddyId);
    newBuddy.setAlias(nickname);
    request(new CreateItemsCmd(newBuddy.toSsiItem()));
    gotBuddy(newBuddy);
  }
  for (  BuddyItem buddy : buddies.values()) {
    if (buddy.getScreenname().equalsIgnoreCase(contact)) {
      if (buddy.getGroupId() == 0 && !grouplist.equals(DEFAULT_AIM_GROUP)) {
        Log.debug("Removing " + buddy + " from main group");
        request(new DeleteItemsCmd(buddy.toSsiItem()));
        buddies.remove("" + buddy.getGroupId() + "."+ buddy.getId());
      }
 else       if (!groups.containsKey(buddy.getGroupId())) {
        Log.debug("Removing " + buddy + " because of unknown group");
        request(new DeleteItemsCmd(buddy.toSsiItem()));
        buddies.remove("" + buddy.getGroupId() + "."+ buddy.getId());
      }
 else       if (!grouplist.contains(groups.get(buddy.getGroupId()).getGroupName())) {
        Log.debug("Removing " + buddy + " because not in list of groups");
        request(new DeleteItemsCmd(buddy.toSsiItem()));
        buddies.remove("" + buddy.getGroupId() + "."+ buddy.getId());
      }
 else {
        if (buddy.getAlias() == null || !buddy.getAlias().equals(nickname)) {
          buddy.setAlias(nickname);
          request(new ModifyItemsCmd(buddy.toSsiItem()));
        }
      }
    }
  }
}

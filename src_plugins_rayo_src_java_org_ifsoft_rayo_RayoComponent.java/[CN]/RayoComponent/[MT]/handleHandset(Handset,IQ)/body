{
  Log.info("RayoComponent handleHandset " + iq.getFrom());
  final IQ reply=IQ.createResultIQ(iq);
  final RelayChannel channel=plugin.createRelayChannel(iq.getFrom(),handset);
  if (channel != null) {
    final Element childElement=reply.setChildElement("ref","urn:xmpp:rayo:1");
    childElement.addAttribute(HOST,LocalIPResolver.getLocalIP());
    childElement.addAttribute(LOCAL_PORT,Integer.toString(channel.getPortA()));
    childElement.addAttribute(REMOTE_PORT,Integer.toString(channel.getPortB()));
    childElement.addAttribute(ID,channel.getAttachment());
    childElement.addAttribute(URI,"handset:" + channel.getAttachment() + "@rayo."+ getDomain()+ "/"+ iq.getFrom().getNode());
    Log.debug("Created handset channel {}:{}, {}:{}, {}:{}",new Object[]{HOST,LocalIPResolver.getLocalIP(),LOCAL_PORT,Integer.toString(channel.getPortA()),REMOTE_PORT,Integer.toString(channel.getPortB())});
  }
 else {
    reply.setError(PacketError.Condition.internal_server_error);
  }
  return reply;
}

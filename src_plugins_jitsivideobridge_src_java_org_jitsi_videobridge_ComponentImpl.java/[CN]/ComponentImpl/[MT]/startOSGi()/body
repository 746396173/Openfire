{
synchronized (frameworkSyncRoot) {
    if (this.framework != null)     return;
  }
  FrameworkFactory frameworkFactory=new FrameworkFactoryImpl();
  Map<String,String> configuration=new HashMap<String,String>();
  configuration.put(Constants.FRAMEWORK_BEGINNING_STARTLEVEL,Integer.toString(BUNDLES.length));
  Framework framework=frameworkFactory.newFramework(configuration);
  try {
    framework.init();
    BundleContext bundleContext=framework.getBundleContext();
    bundleContext.registerService(Component.class,this,null);
    for (int startLevelMinus1=0; startLevelMinus1 < BUNDLES.length; startLevelMinus1++) {
      int startLevel=startLevelMinus1 + 1;
      for (      String location : BUNDLES[startLevelMinus1]) {
        Bundle bundle=bundleContext.installBundle(location);
        if (bundle != null) {
          BundleStartLevel bundleStartLevel=bundle.adapt(BundleStartLevel.class);
          if (bundleStartLevel != null)           bundleStartLevel.setStartLevel(startLevel);
        }
      }
    }
    framework.start();
  }
 catch (  BundleException be) {
    throw new RuntimeException(be);
  }
synchronized (frameworkSyncRoot) {
    this.framework=framework;
  }
}

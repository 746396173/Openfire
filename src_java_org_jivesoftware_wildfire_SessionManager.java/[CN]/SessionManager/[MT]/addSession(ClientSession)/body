{
  boolean success=false;
  String username=session.getAddress().getNode();
  SessionMap resources=null;
synchronized (username.intern()) {
    resources=sessions.get(username);
    if (resources == null) {
      resources=new SessionMap();
      sessions.put(username,resources);
    }
    resources.addSession(session);
    preAuthenticatedSessions.remove(new JID(null,session.getAddress().getDomain(),session.getStreamID().toString()).toString());
    SessionEventDispatcher.dispatchEvent(session,SessionEventDispatcher.EventType.session_created);
    success=true;
  }
  return success;
}

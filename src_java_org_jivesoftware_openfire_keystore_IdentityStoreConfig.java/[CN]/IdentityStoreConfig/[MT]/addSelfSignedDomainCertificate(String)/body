{
  final int keySize;
  final String signAlgorithm;
switch (algorithm.toUpperCase()) {
case "RSA":
    keySize=JiveGlobals.getIntProperty("cert.rsa.keysize",2048);
  signAlgorithm="SHA1WITHRSAENCRYPTION";
break;
case "DSA":
keySize=JiveGlobals.getIntProperty("cert.dsa.keysize",1024);
signAlgorithm="SHA1withDSA";
break;
default :
throw new IllegalArgumentException("Unsupported algorithm '" + algorithm + "'. Use 'RSA' or 'DSA'.");
}
final String name=JiveGlobals.getProperty("xmpp.domain").toLowerCase();
final String alias=name + "_" + algorithm.toLowerCase();
final String distinctName="cn=" + name;
final String domain="*." + name;
final int validityInDays=60;
try {
final KeyPair keyPair=generateKeyPair(algorithm.toUpperCase(),keySize);
final X509Certificate cert=CertificateManager.createX509V3Certificate(keyPair,validityInDays,distinctName,distinctName,domain,signAlgorithm);
store.setKeyEntry(alias,keyPair.getPrivate(),password,new X509Certificate[]{cert});
persist();
}
 catch (CertificateStoreConfigException|IOException|GeneralSecurityException ex) {
reload();
throw new CertificateStoreConfigException("Unable to generate new self-signed " + algorithm + " certificate.",ex);
}
}

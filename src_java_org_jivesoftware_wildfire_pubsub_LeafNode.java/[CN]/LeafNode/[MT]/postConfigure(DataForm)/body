{
  List<String> values;
  if (!persistPublishedItems) {
    maxPublishedItems=1;
  }
 else {
    FormField field=completedForm.getField("pubsub#max_items");
    if (field != null) {
      values=field.getValues();
      maxPublishedItems=values.size() > 0 ? Integer.parseInt(values.get(0)) : 50;
    }
  }
  while (!publishedItems.isEmpty() && publishedItems.size() > maxPublishedItems) {
    PublishedItem removedItem=publishedItems.remove(0);
    itemsByID.remove(removedItem.getID());
    service.getPubSubEngine().queueItemToRemove(removedItem);
  }
}

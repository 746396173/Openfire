{
  if (token == null || token.isAnonymous()) {
    throw new UnauthorizedException("Auth token not valid");
  }
  if (provider == null) {
    throw new IllegalStateException("Factory not configured with provider");
  }
  return provider.getServiceLookup();
}

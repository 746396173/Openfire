{
  User user=null;
  try {
    user=userManager.getUser(presence.getFrom().getNode());
  }
 catch (  UserNotFoundException e) {
    Log.error(LocaleUtils.getLocalizedString("admin.error"),e);
  }
  if (user != null) {
synchronized (onlineUsers) {
      onlineUsers.put(user.getUsername(),presence);
    }
  }
 else {
synchronized (onlineGuests) {
      onlineGuests.put(presence.getID(),presence);
    }
  }
}

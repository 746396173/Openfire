{
  try {
    if (server.isLocal(probee)) {
      Collection<Session> sessions=sessionManager.getSessions(probee.getNode());
      for (      Session session : sessions) {
        Presence presencePacket=session.getPresence().createCopy();
        presencePacket.setFrom(session.getAddress());
        try {
          deliverer.deliver(presencePacket);
        }
 catch (        Exception e) {
          Log.error(LocaleUtils.getLocalizedString("admin.error"),e);
        }
      }
    }
 else {
      Presence presence=(Presence)foreignUserCache.get(probee.toBareJID());
      if (presence != null) {
        Presence presencePacket=presence.createCopy();
        presencePacket.setFrom(probee);
        try {
          deliverer.deliver(presencePacket);
        }
 catch (        Exception e) {
          Log.error(LocaleUtils.getLocalizedString("admin.error"),e);
        }
      }
    }
  }
 catch (  UnauthorizedException e) {
    Log.error(LocaleUtils.getLocalizedString("admin.error"),e);
  }
}

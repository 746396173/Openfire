{
  IQ iq=(IQ)packet;
  try {
    iq=handleIQ(iq);
    if (iq != null) {
      deliverer.deliver(iq);
    }
  }
 catch (  org.jivesoftware.messenger.auth.UnauthorizedException e) {
    if (iq != null) {
      try {
        IQ response=IQ.createResultIQ(iq);
        response.setChildElement(iq.getChildElement().createCopy());
        response.setError(PacketError.Condition.not_authorized);
        Session session=sessionManager.getSession(iq.getFrom());
        if (!session.getConnection().isClosed()) {
          session.getConnection().deliver(response);
        }
      }
 catch (      Exception de) {
        Log.error(LocaleUtils.getLocalizedString("admin.error"),de);
        sessionManager.getSession(iq.getFrom()).getConnection().close();
      }
    }
  }
catch (  Exception e) {
    Log.error(LocaleUtils.getLocalizedString("admin.error"),e);
  }
}

{
  boolean wasClosed=false;
synchronized (this) {
    if (!isClosed()) {
      try {
        if (session != null) {
          session.setStatus(Session.STATUS_CLOSED);
        }
synchronized (writer) {
          try {
            SocketSendingTracker.getInstance().socketStartedSending(socket);
            writer.write("</stream:stream>");
            if (flashClient) {
              writer.write('\0');
            }
            writer.flush();
          }
 catch (          IOException e) {
          }
 finally {
            SocketSendingTracker.getInstance().socketFinishedSending(socket);
          }
        }
      }
 catch (      Exception e) {
        Log.error(LocaleUtils.getLocalizedString("admin.error.close") + "\n" + this.toString(),e);
      }
      try {
        socket.close();
      }
 catch (      Exception e) {
        Log.error(LocaleUtils.getLocalizedString("admin.error.close") + "\n" + this.toString(),e);
      }
      wasClosed=true;
    }
  }
  if (wasClosed) {
    notifyCloseListeners();
  }
}

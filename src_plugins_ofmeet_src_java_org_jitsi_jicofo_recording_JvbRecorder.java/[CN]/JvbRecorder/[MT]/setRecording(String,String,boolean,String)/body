{
  ColibriConferenceIQ toggleRecordingIq=new ColibriConferenceIQ();
  toggleRecordingIq.setID(conferenceId);
  toggleRecordingIq.setTo(recorderComponentJid);
  toggleRecordingIq.setType(IQ.Type.SET);
  toggleRecordingIq.setRecording(new ColibriConferenceIQ.Recording(!isRecording ? State.ON : State.OFF,token));
  Packet reply=xmpp.getXmppConnection().sendPacketAndGetReply(toggleRecordingIq);
  logger.info("REC reply received: " + reply.toXML());
  if (reply instanceof ColibriConferenceIQ) {
    ColibriConferenceIQ colibriReply=(ColibriConferenceIQ)reply;
    ColibriConferenceIQ.Recording recording=colibriReply.getRecording();
    if (recording != null) {
      isRecording=recording.getState().equals(State.ON) || recording.getState().equals(State.PENDING);
      logger.info("REC status: " + conferenceId + ": "+ isRecording);
    }
 else {
      return false;
    }
  }
 else {
    logger.error(conferenceId + " unexpected response received: " + reply.toXML());
  }
  return true;
}

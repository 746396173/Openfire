{
  if (locale == null) {
    if (xmlProperties != null) {
      String[] localeArray=((String)xmlProperties.getProperty("locale")).split("_");
      String language=localeArray[0];
      if (language == null) {
        language="";
      }
      String country="";
      if (localeArray.length == 2) {
        country=localeArray[1];
      }
      if (language.equals("") && country.equals("")) {
        locale=Locale.getDefault();
      }
 else {
        locale=new Locale(language,country);
      }
    }
 else {
      return Locale.getDefault();
    }
  }
  return locale;
}

{
  if (failedLoading) {
    return;
  }
  if (xmlProperties == null) {
    if (messengerHome == null) {
      messengerHome=new InitPropLoader().getMessengerHome();
    }
    if (messengerHome == null) {
      try {
        InitialContext context=new InitialContext();
        messengerHome=(String)context.lookup("java:comp/env/messengerHome");
      }
 catch (      Exception e) {
      }
    }
    if (messengerHome == null) {
      messengerHome=System.getProperty("messengerHome");
    }
    if (messengerHome == null) {
      try {
        messengerHome=new File("..").getCanonicalPath();
        if (!new File(messengerHome,"conf/jive-messenger.xml").exists()) {
          messengerHome=null;
        }
      }
 catch (      IOException e) {
        e.printStackTrace();
      }
    }
    if (messengerHome == null) {
      try {
        messengerHome=new File("").getCanonicalPath();
        if (!new File(messengerHome,"conf/jive-messenger.xml").exists()) {
          messengerHome=null;
        }
      }
 catch (      IOException e) {
        e.printStackTrace();
      }
    }
    if (messengerHome == null) {
      failedLoading=true;
      StringBuilder msg=new StringBuilder();
      msg.append("Critical Error! The messengerHome directory could not be loaded, \n");
      msg.append("which will prevent the application from working correctly.\n\n");
      msg.append("You must set messengerHome in one of four ways:\n");
      msg.append("    1) Set a servlet init parameter named messengerHome.\n");
      msg.append("    2) Add a messenger_init.xml file to your classpath, which points \n ");
      msg.append("       to messengerHome. Normally, this file will be in WEB-INF/classes.\n");
      msg.append("    3) Set the JNDI value \"java:comp/env/messengerHome\" with a String \n");
      msg.append("       that points to your messengerHome directory. \n");
      msg.append("    4) Set the Java system property \"messengerHome\".\n\n");
      msg.append("Further instructions for setting messengerHome can be found in the \n");
      msg.append("installation documentation.");
      System.err.println(msg.toString());
      return;
    }
    try {
      File mh=new File(messengerHome);
      if (!mh.exists()) {
        Log.error("Error - the specified messengerHome directory does not exist (" + messengerHome + ")");
      }
 else {
        if (!mh.canRead() || !mh.canWrite()) {
          Log.error("Error - the user running this Jive application can not read and write to the " + "specified jiveHome directory (" + messengerHome + "). Please grant the executing user "+ "read and write perms.");
        }
      }
      xmlProperties=new XMLProperties(messengerHome + File.separator + "conf"+ File.separator+ JIVE_CONFIG_FILENAME);
    }
 catch (    IOException ioe) {
      Log.error(ioe);
      failedLoading=true;
      return;
    }
  }
}

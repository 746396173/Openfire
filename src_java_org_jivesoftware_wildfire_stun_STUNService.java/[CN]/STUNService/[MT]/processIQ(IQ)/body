{
  IQ reply=IQ.createResultIQ(iq);
  Element childElement=iq.getChildElement();
  String namespace=childElement.getNamespaceURI();
  Element childElementCopy=iq.getChildElement().createCopy();
  reply.setChildElement(childElementCopy);
  if ("http://jabber.org/protocol/disco#info".equals(namespace)) {
    reply=XMPPServer.getInstance().getIQDiscoInfoHandler().handleIQ(iq);
    router.route(reply);
    return;
  }
 else   if ("http://jabber.org/protocol/disco#items".equals(namespace)) {
    reply=XMPPServer.getInstance().getIQDiscoItemsHandler().handleIQ(iq);
    router.route(reply);
    return;
  }
 else   if (NAMESPACE.equals(namespace)) {
    Element stun=childElementCopy.addElement("stun");
    Element server=stun.addElement("server");
    server.addAttribute("host",primaryAddress);
    server.addAttribute("udp",String.valueOf(primaryPort));
  }
 else {
    reply.setError(PacketError.Condition.service_unavailable);
  }
  try {
    Log.debug("RETURNED:" + reply.toXML());
    router.route(reply);
  }
 catch (  Exception e) {
    Log.error(e);
  }
}

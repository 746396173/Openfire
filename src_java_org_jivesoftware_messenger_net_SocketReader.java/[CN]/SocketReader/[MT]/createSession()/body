{
  XmlPullParser xpp=reader.getXPPParser();
  for (int eventType=xpp.getEventType(); eventType != XmlPullParser.START_TAG; ) {
    eventType=xpp.next();
  }
  String host=reader.getXPPParser().getAttributeValue("","to");
  if (validateHost() && isHostUnknown(host)) {
    Writer writer=connection.getWriter();
    StringBuilder sb=new StringBuilder();
    sb.append("<?xml version='1.0' encoding='");
    sb.append(CHARSET);
    sb.append("'?>");
    StreamError error=new StreamError(StreamError.Condition.host_unknown);
    sb.append(error.toXML());
    writer.write(sb.toString());
    writer.flush();
    connection.close();
  }
 else   if (!createSession(xpp.getNamespace(null))) {
    Writer writer=connection.getWriter();
    StringBuilder sb=new StringBuilder();
    sb.append("<?xml version='1.0' encoding='");
    sb.append(CHARSET);
    sb.append("'?>");
    StreamError error=new StreamError(StreamError.Condition.bad_namespace_prefix);
    sb.append(error.toXML());
    writer.write(sb.toString());
    writer.flush();
    connection.close();
  }
}

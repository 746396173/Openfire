{
  try {
    reader=new XPPPacketReader();
    reader.setXPPFactory(factory);
    reader.getXPPParser().setInput(new InputStreamReader(socket.getInputStream(),CHARSET));
    try {
      createSession();
    }
 catch (    IOException e) {
      Log.debug("Error creating session",e);
      throw e;
    }
    if (session != null) {
      readStream();
    }
  }
 catch (  EOFException eof) {
  }
catch (  SocketException se) {
  }
catch (  AsynchronousCloseException ace) {
  }
catch (  XmlPullParserException ie) {
  }
catch (  Exception e) {
    if (session != null) {
      Log.warn(LocaleUtils.getLocalizedString("admin.error.stream"),e);
    }
  }
 finally {
    if (session != null) {
      Log.debug("Logging off " + session.getAddress() + " on "+ connection);
      try {
        session.getConnection().close();
      }
 catch (      Exception e) {
        Log.warn(LocaleUtils.getLocalizedString("admin.error.connection") + "\n" + socket.toString());
      }
    }
 else {
      Log.error(LocaleUtils.getLocalizedString("admin.error.connection") + "\n" + socket.toString());
    }
    shutdown();
  }
}

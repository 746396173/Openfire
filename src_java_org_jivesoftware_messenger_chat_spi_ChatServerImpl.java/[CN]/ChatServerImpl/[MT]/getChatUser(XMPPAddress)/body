{
  if (router == null) {
    throw new IllegalStateException("Not initialized");
  }
  ChatUser user=null;
synchronized (users) {
    user=(ChatUser)users.get(userjid);
    if (user == null) {
      user=new ChatUserImpl(this,router,userjid);
      users.put(userjid,user);
    }
  }
  return user;
}

{
  for (int i=0; i < conCount; i++) {
    ConnectionWrapper wrapper=wrappers[i];
    if (wrapper == null) {
      break;
    }
synchronized (wrapper) {
      if (!wrapper.checkedout) {
        wrapper.setConnection(cons[i]);
        wrapper.checkedout=true;
        wrapper.lockTime=System.currentTimeMillis();
        if ("true".equals(JiveGlobals.getXMLProperty("database.defaultProvider.checkOpenConnections"))) {
          wrapper.exception=new Exception();
          wrapper.hasLoggedException=false;
        }
        used.incrementAndGet();
        return wrapper;
      }
    }
  }
synchronized (conCountLock) {
    if (conCount >= maxCon) {
      return null;
    }
    ConnectionWrapper con=createCon(conCount);
    conCount++;
    used.incrementAndGet();
    return con;
  }
}

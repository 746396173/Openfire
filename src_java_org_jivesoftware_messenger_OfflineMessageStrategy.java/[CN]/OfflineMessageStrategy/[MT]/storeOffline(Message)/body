{
  if (message != null) {
    JID recipientJID=message.getTo();
    if (recipientJID == null || serverAddress.equals(recipientJID) || recipientJID.getNode() == null) {
      return;
    }
    JID senderJID=message.getFrom();
    if (senderJID != null && mucServiceDomain.equals(senderJID.getDomain())) {
      return;
    }
    if (type == Type.bounce) {
      bounce(message);
    }
 else     if (type == Type.store) {
      store(message);
    }
 else     if (type == Type.store_and_bounce) {
      if (underQuota(message)) {
        store(message);
      }
 else {
        bounce(message);
      }
    }
 else     if (type == Type.store_and_drop) {
      if (underQuota(message)) {
        store(message);
      }
    }
  }
}

{
  StreamID streamID=SessionManager.getInstance().nextStreamID();
  IncomingServerSession session=SessionManager.getInstance().createIncomingServerSession(connection,streamID);
  StringBuilder openingStream=new StringBuilder();
  openingStream.append("<stream:stream");
  openingStream.append(" xmlns:stream=\"http://etherx.jabber.org/streams\"");
  openingStream.append(" xmlns=\"jabber:server\"");
  openingStream.append(" from=\"").append(serverName).append("\"");
  openingStream.append(" id=\"").append(streamID).append("\"");
  openingStream.append(" version=\"1.0\">");
  connection.deliverRawText(openingStream.toString());
  StringBuilder sb=new StringBuilder();
  sb.append("<stream:features>");
  sb.append("<starttls xmlns=\"urn:ietf:params:xml:ns:xmpp-tls\">");
  sb.append("</starttls>");
  sb.append(SASLAuthentication.getSASLMechanisms(session));
  sb.append("</stream:features>");
  connection.deliverRawText(sb.toString());
  session.setLocalDomain(serverName);
  return session;
}

{
  try {
    System.setProperty("org.apache.commons.logging.LogFactory","org.mortbay.log.Factory");
    File logDir=new File(JiveGlobals.getMessengerHome(),"logs");
    if (!logDir.exists()) {
      logDir.mkdirs();
    }
    File logFile=new File(logDir,"admin-console.log");
    OutputStreamLogSink logSink=new OutputStreamLogSink(logFile.toString());
    logSink.start();
    LogImpl log=(LogImpl)Factory.getFactory().getInstance("");
    log.setVerbose(-1);
    log.add(logSink);
    jetty=new Server();
    boolean plainStarted=false;
    port=JiveGlobals.getXMLProperty("adminConsole.port",9090);
    if (port > 0) {
      jetty.addListener(Integer.toString(port));
      plainStarted=true;
    }
    boolean secureStarted=false;
    try {
      securePort=JiveGlobals.getXMLProperty("adminConsole.securePort",9091);
      if (securePort > 0) {
        SunJsseListener listener=new SunJsseListener();
        String keyStoreLocation=JiveGlobals.getProperty("xmpp.socket.ssl.keystore","resources" + File.separator + "security"+ File.separator+ "keystore");
        keyStoreLocation=JiveGlobals.getMessengerHome() + File.separator + keyStoreLocation;
        String keypass=JiveGlobals.getProperty("xmpp.socket.ssl.keypass","changeit");
        keypass=keypass.trim();
        String trustStoreLocation=JiveGlobals.getProperty("xmpp.socket.ssl.truststore","resources" + File.separator + "security"+ File.separator+ "truststore");
        trustStoreLocation=JiveGlobals.getMessengerHome() + File.separator + trustStoreLocation;
        String trustpass=JiveGlobals.getProperty("xmpp.socket.ssl.trustpass","changeit");
        trustpass=trustpass.trim();
        listener.setKeystore(keyStoreLocation);
        listener.setKeyPassword(keypass);
        listener.setPassword(keypass);
        listener.setPort(securePort);
        jetty.addListener(listener);
        secureStarted=true;
      }
    }
 catch (    Exception e) {
      Log.error(e);
    }
    WebApplicationContext webAppContext=jetty.addWebApplication("/",pluginDir.getAbsoluteFile() + File.separator + "webapp");
    webAppContext.setWelcomeFiles(new String[]{"index.jsp"});
    jetty.start();
    if (!plainStarted && !secureStarted) {
      Log.info("Warning: admin console not started due to configuration settings.");
      System.out.println("Warning: admin console not started due to configuration settings.");
    }
 else     if (!plainStarted && secureStarted) {
      Log.info("Admin console listening at https://" + XMPPServer.getInstance().getServerInfo().getName() + ":"+ securePort);
      System.out.println("Admin console listening at https://" + XMPPServer.getInstance().getServerInfo().getName() + ":"+ securePort);
    }
 else     if (!secureStarted && plainStarted) {
      Log.info("Admin console listening at http://" + XMPPServer.getInstance().getServerInfo().getName() + ":"+ port);
      System.out.println("Admin console listening at http://" + XMPPServer.getInstance().getServerInfo().getName() + ":"+ port);
    }
 else {
      String msg="Admin console listening at:\n" + "  http://" + XMPPServer.getInstance().getServerInfo().getName() + ":"+ port+ "\n"+ "  https://"+ XMPPServer.getInstance().getServerInfo().getName()+ ":"+ securePort;
      Log.info(msg);
      System.out.println(msg);
    }
  }
 catch (  Exception e) {
    Log.error("Trouble initializing admin console",e);
  }
}

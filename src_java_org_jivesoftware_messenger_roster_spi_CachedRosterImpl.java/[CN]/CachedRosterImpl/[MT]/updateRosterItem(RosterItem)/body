{
  CachedRosterItem cachedItem=null;
  if (item instanceof CachedRosterItem) {
    cachedItem=(CachedRosterItem)item;
  }
 else {
    cachedItem=(CachedRosterItem)super.getRosterItem(item.getJid());
    cachedItem=new CachedRosterItemImpl(cachedItem.getID(),item);
  }
  super.updateRosterItem(cachedItem);
  rosterItemProvider.updateItem(username,cachedItem);
  if (!(cachedItem.getSubStatus() == RosterItem.SUB_NONE && cachedItem.getAskStatus() == RosterItem.ASK_NONE)) {
    Roster roster=new Roster();
    roster.setType(IQ.Type.set);
    roster.addItem(cachedItem.getJid(),cachedItem.getNickname(),getAskStatus(cachedItem.getAskStatus()),Roster.Subscription.valueOf(cachedItem.getSubStatus().getName()),cachedItem.getGroups());
    broadcast(roster);
  }
  if (cachedItem.getSubStatus() == RosterItem.SUB_BOTH || cachedItem.getSubStatus() == RosterItem.SUB_TO) {
    if (presenceManager == null) {
      presenceManager=XMPPServer.getInstance().getPresenceManager();
    }
    presenceManager.probePresence(username,cachedItem.getJid());
  }
}

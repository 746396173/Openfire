{
synchronized (initLock) {
    try {
      String driver="org.hsqldb.jdbcDriver";
      File databaseDir=new File(JiveGlobals.getMessengerHome(),File.separator + "embedded-db");
      boolean initData=false;
      if (!databaseDir.exists()) {
        databaseDir.mkdirs();
        initData=true;
      }
      String serverURL="jdbc:hsqldb:" + databaseDir.getCanonicalPath() + File.separator+ "messenger";
      String username="sa";
      String password="";
      int minConnections=3;
      int maxConnections=10;
      double connectionTimeout=0.5;
      connectionPool=new ConnectionPool(driver,serverURL,username,password,minConnections,maxConnections,connectionTimeout,false);
      if (initData) {
        initializeDatabase();
      }
 else {
        try {
          upgradeDatabase();
        }
 catch (        Exception e) {
          Log.error(e);
        }
      }
    }
 catch (    IOException ioe) {
      Log.error("Error starting connection pool.",ioe);
    }
  }
}

{
  this.presenceType=presenceType;
  this.verboseStatus=verboseStatus;
  final PresenceType pType=presenceType;
  if (!isLoggedIn() && getLoginStatus() != TransportLoginStatus.LOGGING_IN && loginAttempts <= 3) {
    setLoginStatus(TransportLoginStatus.LOGGING_IN);
    new Thread(){
      public void run(){
        try {
          loginAttempts++;
          yahooSession.setStatus(StatusConstants.STATUS_AVAILABLE);
          yahooSession.login(registration.getUsername(),registration.getPassword());
          setLoginStatus(TransportLoginStatus.LOGGED_IN);
          Presence p=new Presence();
          p.setTo(getJID());
          p.setFrom(getTransport().getJID());
          getTransport().sendPacket(p);
          yahooSession.setStatus(((YahooTransport)getTransport()).convertJabStatusToYahoo(pType));
          getRegistration().setLastLogin(new Date());
          syncUsers();
        }
 catch (        LoginRefusedException e) {
          yahooSession.reset();
          Log.warn("Yahoo login failed for " + getJID());
          Message m=new Message();
          m.setType(Message.Type.error);
          m.setTo(getJID());
          m.setFrom(getTransport().getJID());
          m.setBody("Failed to log into Yahoo! messenger account.  (login refused)");
          getTransport().sendPacket(m);
          setLoginStatus(TransportLoginStatus.LOGGED_OUT);
        }
catch (        IOException e) {
          Log.error("Yahoo login caused IO exception:",e);
          Message m=new Message();
          m.setType(Message.Type.error);
          m.setTo(getJID());
          m.setFrom(getTransport().getJID());
          m.setBody("Failed to log into Yahoo! messenger account.  (unknown error)");
          getTransport().sendPacket(m);
          setLoginStatus(TransportLoginStatus.LOGGED_OUT);
        }
      }
    }
.run();
  }
}

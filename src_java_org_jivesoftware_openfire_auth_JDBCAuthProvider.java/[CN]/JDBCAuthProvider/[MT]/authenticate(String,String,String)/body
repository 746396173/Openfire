{
  if (passwordType != PasswordType.plain) {
    throw new UnsupportedOperationException("Digest authentication not supported for " + "password type " + passwordType);
  }
  if (username == null || token == null || digest == null) {
    throw new UnauthorizedException();
  }
  username=username.trim().toLowerCase();
  String password;
  try {
    password=getPasswordValue(username);
  }
 catch (  UserNotFoundException unfe) {
    throw new UnauthorizedException();
  }
  String anticipatedDigest=AuthFactory.createDigest(token,password);
  if (!digest.equalsIgnoreCase(anticipatedDigest)) {
    throw new UnauthorizedException();
  }
  createUser(username);
}

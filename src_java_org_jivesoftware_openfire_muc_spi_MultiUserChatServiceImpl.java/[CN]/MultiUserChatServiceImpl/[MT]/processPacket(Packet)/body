{
  if (!isServiceEnabled()) {
    return;
  }
  try {
    if (packet instanceof IQ) {
      if (process((IQ)packet)) {
        return;
      }
    }
    if (packet.getError() != null && packet.getError().getType().equals(PacketError.Type.cancel)) {
      removeUser(packet.getFrom());
    }
 else {
      JID receipient=packet.getTo();
      String roomName=receipient != null ? receipient.getNode() : null;
      getChatUser(packet.getFrom(),roomName).process(packet);
    }
  }
 catch (  Exception e) {
    Log.error(LocaleUtils.getLocalizedString("admin.error"),e);
  }
}

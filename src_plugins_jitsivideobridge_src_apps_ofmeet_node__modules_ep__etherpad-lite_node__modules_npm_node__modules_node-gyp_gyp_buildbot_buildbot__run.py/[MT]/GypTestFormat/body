def GypTestFormat(title, format=None, msvs_version=None):
    'Run the gyp tests for a given format, emitting annotator tags.\n\n  See annotator docs at:\n    https://sites.google.com/a/chromium.org/dev/developers/testing/chromium-build-infrastructure/buildbot-annotations\n  Args:\n    format: gyp format to test.\n  Returns:\n    0 for sucesss, 1 for failure.\n  '
    if (not format):
        format = title
    print (('@@@BUILD_STEP ' + title) + '@@@')
    sys.stdout.flush()
    env = os.environ.copy()
    if msvs_version:
        env['GYP_MSVS_VERSION'] = msvs_version
    command = ' '.join([sys.executable, 'trunk/gyptest.py', '--all', '--passed', '--format', format, '--chdir', 'trunk'])
    if (format == 'android'):
        retcode = subprocess.call(['/bin/bash', '-c', ('source build/envsetup.sh && lunch full-eng && cd %s && %s' % (ROOT_DIR, command))], cwd=ANDROID_DIR, env=env)
    else:
        retcode = subprocess.call(command, cwd=ROOT_DIR, env=env, shell=True)
    if retcode:
        print '@@@STEP_FAILURE@@@'
        return 1
    return 0

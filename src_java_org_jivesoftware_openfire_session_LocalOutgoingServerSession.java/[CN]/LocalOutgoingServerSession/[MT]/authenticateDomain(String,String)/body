{
  if (hostname == null || hostname.length() == 0 || hostname.trim().indexOf(' ') > -1) {
    return null;
  }
  try {
    if (!RemoteServerManager.canAccess(hostname)) {
      return null;
    }
    OutgoingServerSession session;
    SessionManager sessionManager=SessionManager.getInstance();
    if (sessionManager == null) {
      return null;
    }
    session=sessionManager.getOutgoingServerSession(hostname);
    if (session == null) {
      for (      IncomingServerSession incomingSession : sessionManager.getIncomingServerSessions(hostname)) {
        for (        String otherHostname : incomingSession.getValidatedDomains()) {
          session=sessionManager.getOutgoingServerSession(otherHostname);
          if (session != null) {
            if (session.isUsingServerDialback()) {
              break;
            }
 else {
              session=null;
            }
          }
        }
      }
    }
    if (session == null) {
      int port=RemoteServerManager.getPortForServer(hostname);
      session=createOutgoingSession(domain,hostname,port);
      if (session != null) {
        session.addAuthenticatedDomain(domain);
        session.addHostname(hostname);
        sessionManager.outgoingServerSessionCreated((LocalOutgoingServerSession)session);
        return session;
      }
 else {
        Log.warn("Fail to connect to {} for {}",hostname,domain);
        return null;
      }
    }
    if (session.getAuthenticatedDomains().contains(domain) && session.getHostnames().contains(hostname)) {
      return session;
    }
    if (session.authenticateSubdomain(domain,hostname))     return session;
  }
 catch (  Exception e) {
    Log.error("Error authenticating domain with remote server: " + hostname,e);
  }
  return null;
}

{
  Log.debug("[domain {} hostname {}]: Start authentication.",domain,hostname);
  if (hostname == null || hostname.length() == 0 || hostname.trim().indexOf(' ') > -1) {
    Log.debug("[domain {} hostname {}]: Authentication failed - null or whitespace in hostname.",domain,hostname);
    return false;
  }
  try {
    if (!RemoteServerManager.canAccess(hostname)) {
      Log.debug("[domain {} hostname {}]: Authentication failed - hostname in blacklist.",domain,hostname);
      return false;
    }
    OutgoingServerSession session;
    SessionManager sessionManager=SessionManager.getInstance();
    if (sessionManager == null) {
      Log.debug("[domain {} hostname {}]: Authentication failed - no session manager available. Server might be shutting down.",domain,hostname);
      return false;
    }
    Log.debug("[domain {} hostname {}]: Locating pre-exisiting outgoing session...",domain,hostname);
    session=sessionManager.getOutgoingServerSession(hostname);
    if (session == null) {
      Log.debug("[domain {} hostname {}]: Outgoing session found. Locating related incoming session...",domain,hostname);
      for (      IncomingServerSession incomingSession : sessionManager.getIncomingServerSessions(hostname)) {
        for (        String otherHostname : incomingSession.getValidatedDomains()) {
          session=sessionManager.getOutgoingServerSession(otherHostname);
          if (session != null) {
            if (session.isUsingServerDialback()) {
              Log.debug("[domain {} hostname {}]: Incoming session found. Reuse this connection.",domain,hostname);
              break;
            }
 else {
              session=null;
            }
          }
        }
      }
    }
    if (session == null) {
      Log.debug("[domain {} hostname {}]: No re-usable existing connecting. Create new session.",domain,hostname);
      int port=RemoteServerManager.getPortForServer(hostname);
      session=createOutgoingSession(domain,hostname,port);
      if (session != null) {
        session.addAuthenticatedDomain(domain);
        session.addHostname(hostname);
        sessionManager.outgoingServerSessionCreated((LocalOutgoingServerSession)session);
        return true;
      }
 else {
        Log.warn("Fail to connect to {} for {}",hostname,domain);
        return false;
      }
    }
    if (session.getAuthenticatedDomains().contains(domain) && session.getHostnames().contains(hostname)) {
      Log.debug("[domain {} hostname {}]: Do nothing since the domain has already been authenticated.",domain,hostname);
      return true;
    }
    Log.debug("[domain {} hostname {}]: An session already exists, so authenticate the domain using that session.",domain,hostname);
    return session.authenticateSubdomain(domain,hostname);
  }
 catch (  Exception e) {
    Log.error("Error authenticating domain with remote server: " + hostname,e);
  }
  return false;
}

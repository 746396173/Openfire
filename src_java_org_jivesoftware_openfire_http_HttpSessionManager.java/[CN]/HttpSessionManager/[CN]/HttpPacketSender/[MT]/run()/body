{
  Collection<Element> elements=null;
  try {
    elements=session.getPacketsToSend(20,TimeUnit.MILLISECONDS);
  }
 catch (  HttpConnectionClosedException he) {
    return;
  }
catch (  Throwable t) {
  }
  if (elements == null) {
    this.init();
    return;
  }
  SessionPacketRouter router=new SessionPacketRouter(session);
  try {
    for (    Element packet : elements) {
      try {
        router.route(packet);
      }
 catch (      UnsupportedEncodingException e) {
        Log.error("Client provided unsupported encoding type in auth request",e);
      }
catch (      UnknownStanzaException e) {
        Log.error("Client provided unknown packet type",e);
      }
    }
  }
  finally {
    session.releasePacketsToSend();
  }
}

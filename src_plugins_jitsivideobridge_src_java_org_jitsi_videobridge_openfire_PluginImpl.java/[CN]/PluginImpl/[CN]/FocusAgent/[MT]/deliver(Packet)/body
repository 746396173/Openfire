{
  Log.info("FocusAgent deliver\n" + packet + " "+ getVideoBridge());
  IQ iq=(IQ)packet;
  if (iq.getType() == IQ.Type.result) {
    Element conference=iq.getChildElement().createCopy();
    if (focusId == null) {
      focusId=conference.attributeValue("id");
    }
    String id=packet.getID();
    if (ids.containsKey(id)) {
      Participant participant=ids.remove(id);
      String username=participant.getUser().toString();
      if (users.containsKey(username) == false) {
        addUser(participant,conference);
      }
      Log.info("FocusAgent response for user " + participant + " "+ focusId+ "\n"+ conference);
      broadcastSSRC(participant);
    }
 else     Log.error("FocusAgent deliver cannot find iq owner " + id + "\n"+ packet);
  }
 else   if (iq.getType() == IQ.Type.error) {
    closeColibri();
    Log.error("Videobrideg error \n" + packet);
    for (    Participant reciepient : users.values()) {
      sendRayoEvent(reciepient,null,false,reciepient);
    }
  }
 else   if (iq.getType() == IQ.Type.set || iq.getType() == IQ.Type.get) {
    JID user=iq.getFrom();
    Element root=iq.getChildElement();
    Element conference=null;
    if (user.toString().equals("jitsi-videobridge." + domainName)) {
      conference=root.createCopy();
      if (mediaSink == null) {
        try {
        }
 catch (        Exception e) {
          Log.error("Error creating recording file",e);
        }
      }
    }
 else {
      conference=root.element("conference").createCopy();
      IQ reply=IQ.createResultIQ(iq);
      if (users.containsKey(user.toString()))       processUserAnswer(users.get(user.toString()),conference);
 else       reply.setError(PacketError.Condition.not_allowed);
      router.route(reply);
    }
  }
 else {
    Log.warn("Unexpected Videobrideg message \n" + packet);
  }
}

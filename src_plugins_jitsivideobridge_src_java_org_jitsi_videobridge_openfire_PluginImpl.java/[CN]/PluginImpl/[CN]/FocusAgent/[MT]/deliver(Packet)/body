{
  Log.debug("FocusAgent deliver\n" + packet + " "+ getVideoBridge());
  IQ iq=(IQ)packet;
  if (iq.getType() == IQ.Type.result) {
    Element conference=iq.getChildElement().createCopy();
    focusId=conference.attributeValue("id");
    String id=packet.getID();
    if (ids.containsKey(id)) {
      Participant participant=ids.remove(id);
      if (users.containsKey(participant.getUser().toString()))       removeUser(participant);
 else       addUser(participant,conference);
      Log.info("FocusAgent response for user " + participant + " "+ focusId+ "\n"+ conference);
    }
 else     Log.error("FocusAgent deliver cannot find iq owner " + id + "\n"+ packet);
  }
 else   if (iq.getType() == IQ.Type.error) {
    closeColibri();
    Log.error("Videobrideg error \n" + packet);
    for (    Participant reciepient : users.values()) {
      sendRayoEvent(reciepient,null,false,reciepient);
    }
  }
 else   if (iq.getType() == IQ.Type.set || iq.getType() == IQ.Type.get) {
    JID user=iq.getFrom();
    Element root=iq.getChildElement();
    Element conference=null;
    if (user.toString().equals("jitsi-videobridge." + domainName)) {
      conference=root.createCopy();
      String channelId=conference.element("content").element("channel").attributeValue("id");
      if (channels.containsKey(channelId))       broadcastSSRC(channels.get(channelId));
    }
 else {
      conference=root.element("conference").createCopy();
      IQ reply=IQ.createResultIQ(iq);
      if (users.containsKey(user.toString()))       processUserAnswer(users.get(user.toString()),conference);
 else       reply.setError(PacketError.Condition.not_allowed);
      router.route(reply);
    }
  }
 else {
    Log.warn("Unexpected Videobrideg message \n" + packet);
  }
}

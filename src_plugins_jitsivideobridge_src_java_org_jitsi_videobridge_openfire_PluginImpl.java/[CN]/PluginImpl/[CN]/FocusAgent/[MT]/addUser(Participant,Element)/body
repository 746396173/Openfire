{
  Log.info("addUser " + participant);
  count++;
  users.put(participant.getUser().toString(),participant);
  Presence presence=new Presence();
  presence.setFrom(XMPPServer.getInstance().createJID(focusName,focusName));
  presence.setTo(participant.getUser());
  ColibriOfferEvent event=new ColibriOfferEvent();
  event.setMuc(roomJid);
  event.setNickname(participant.getNickname());
  event.setParticipant(participant.getUser());
  event.setConference(conference);
  presence.getElement().add(colibriProvider.toXML(event));
  router.route(presence);
  for (Iterator i=conference.elementIterator("content"); i.hasNext(); ) {
    Element content=(Element)i.next();
    Element channel=content.element("channel");
    if ("video".equals(content.attributeValue("name"))) {
      participant.videoChannelId=channel.attributeValue("id");
      String focusJid=XMPPServer.getInstance().createJID(focusName,focusName).toString();
      Content vbContent=getVideoBridge().getConference(focusId,focusJid).getOrCreateContent("video");
      if (vbContent != null) {
        Channel videoChannel=vbContent.getChannel(participant.videoChannelId);
        if (videoChannel != null) {
          participant.setVideoStream(videoChannel.getMediaStream());
        }
      }
    }
    if ("audio".equals(content.attributeValue("name"))) {
      participant.audioChannelId=channel.attributeValue("id");
      String focusJid=XMPPServer.getInstance().createJID(focusName,focusName).toString();
      Content vbContent=getVideoBridge().getConference(focusId,focusJid).getOrCreateContent("audio");
      if (vbContent != null) {
        Channel audioChannel=vbContent.getChannel(participant.audioChannelId);
        if (audioChannel != null) {
          participant.setAudioStream(audioChannel.getMediaStream());
        }
      }
    }
  }
}

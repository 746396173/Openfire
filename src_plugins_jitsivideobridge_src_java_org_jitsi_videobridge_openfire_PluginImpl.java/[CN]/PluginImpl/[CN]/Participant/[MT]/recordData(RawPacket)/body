{
  try {
    if (packet != null) {
      byte[] rtp=packet.getPayload();
      if (!_sequenceNumberingViolated && _lastSequenceNumber.intValue() > -1 && Vp8Packet.getSequenceNumberDelta(packet.getSequenceNumber(),_lastSequenceNumber).intValue() > 1)       _sequenceNumberingViolated=true;
      _lastSequenceNumber=packet.getSequenceNumber();
      Vp8Packet packet2=Vp8Packet.parseBytes(rtp);
      if (packet2 == null)       return;
      _accumulator.add(packet2);
      byte encodedFrame[]=null;
      if (packet.isPacketMarked()) {
        encodedFrame=Vp8Packet.depacketize(_accumulator.getPackets());
        boolean isKeyframe=encodedFrame != null && encodedFrame.length > 0 && (encodedFrame[0] & 1) == 0;
        if (_sequenceNumberingViolated && isKeyframe)         _sequenceNumberingViolated=false;
        _accumulator.reset();
        if (recorder != null && encodedFrame != null && _sequenceNumberingViolated == false) {
          byte[] full=Arrays.copyOf(encodedFrame,encodedFrame.length);
          recorder.write(full,0,full.length,isKeyframe,packet.getTimestamp());
          if (isKeyframe && snapshot < 1) {
            Log.info("recordData " + " " + packet.getPayloadType() + " "+ full+ " "+ packet.getSequenceNumber()+ " "+ packet.getTimestamp());
            recorder.writeWebPImage(full,0,full.length,packet.getTimestamp());
            snapshot++;
          }
        }
      }
    }
 else {
      Log.error("record video cannot parse packet data " + packet);
    }
  }
 catch (  Exception e) {
    Log.error("Error writing video recording",e);
  }
}

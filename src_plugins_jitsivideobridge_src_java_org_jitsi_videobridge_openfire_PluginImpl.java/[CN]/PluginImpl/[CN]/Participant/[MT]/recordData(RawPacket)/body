{
  if (!snapshot)   Log.info("transferData " + packet.getPayloadLength() + " "+ packet.getHeaderLength()+ " "+ packet.getExtensionLength());
  try {
    if (packet != null) {
      byte[] rtp=packet.getPayload();
      if (rtp.length < 2)       return;
      int vp8Length=packet.getPayloadLength();
      int payloadOffset=0;
      if (partial == null) {
        partial=new byte[0];
      }
      if (!snapshot)       Log.info("expecting X R N S PartID");
      byte x=rtp[payloadOffset];
      payloadOffset++;
      vp8Length--;
      if ((x & 0x80) != 0) {
        if (!snapshot)         Log.info("found I L T RSV-A");
        byte ilt=rtp[payloadOffset];
        payloadOffset++;
        vp8Length--;
        if ((ilt & 0x80) != 0) {
          if (!snapshot)           Log.info("found picture ID");
          payloadOffset++;
          vp8Length--;
        }
        if ((ilt & 0x40) != 0) {
          if (!snapshot)           Log.info("found TL0PICIDX");
          payloadOffset++;
          vp8Length--;
        }
        if ((ilt & 0x20) != 0) {
          if (!snapshot)           Log.info("found TID RSV-B");
          payloadOffset++;
          vp8Length--;
        }
      }
      if ((x & 0x10) != 0) {
        if (!snapshot)         Log.info("found start of partition " + x);
        partial=new byte[0];
      }
      int partialLength=partial.length;
      partial=Arrays.copyOf(partial,partial.length + vp8Length);
      System.arraycopy(rtp,payloadOffset,partial,partialLength,vp8Length);
      int thisseqnum=packet.getSequenceNumber();
      if (lastseqnum != -1 && thisseqnum != lastseqnum + 1) {
        if (!snapshot)         Log.info("VP8:Received packet out of order, discarding frame.");
        partial=null;
        lastseqnum=-1;
        return;
      }
      lastseqnum=thisseqnum;
      if (packet.isPacketMarked()) {
        if (recorder != null && partial != null) {
          byte[] full=Arrays.copyOf(partial,partial.length);
          boolean isKeyframe=(full[0] & 0x1) == 0;
          if (!snapshot)           Log.info("recordData " + " " + packet.getPayloadType() + " "+ full+ " "+ packet.getSequenceNumber()+ " "+ isKeyframe);
          recorder.write(full,0,full.length,isKeyframe,packet.getTimestamp());
          if (isKeyframe && snapshot == false) {
            recorder.writeWebPImage(full,0,full.length,packet.getTimestamp());
            snapshot=true;
          }
        }
        partial=null;
        lastseqnum=-1;
      }
    }
 else {
      Log.error("record video cannot parse packet data " + packet);
    }
  }
 catch (  Exception e) {
    Log.error("Error writing video recording",e);
  }
}

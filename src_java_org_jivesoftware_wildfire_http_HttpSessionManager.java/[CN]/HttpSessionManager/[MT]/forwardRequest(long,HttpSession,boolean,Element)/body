{
  List<Element> elements=rootNode.elements();
  boolean isPoll=elements.size() <= 0;
  HttpConnection connection=new HttpConnection(rid,isSecure);
  session.addConnection(connection,isPoll);
  MultiplexerPacketRouter router=new MultiplexerPacketRouter(session);
  for (  Element packet : elements) {
    try {
      router.route(packet);
      session.incrementClientPacketCount();
    }
 catch (    UnsupportedEncodingException e) {
      throw new HttpBindException("Bad auth request, unknown encoding",true,400);
    }
catch (    UnknownStanzaException e) {
      throw new HttpBindException("Unknown packet type.",false,400);
    }
  }
  return connection;
}

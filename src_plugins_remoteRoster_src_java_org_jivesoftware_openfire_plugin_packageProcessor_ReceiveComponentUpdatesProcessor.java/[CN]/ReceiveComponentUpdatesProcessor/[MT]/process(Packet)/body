{
  IQ myPacket=(IQ)packet;
  String to=myPacket.getTo().toString();
  String username=getUsernameFromJid(to);
  List<Node> nodes=findNodesInDocument(myPacket.getElement().getDocument(),"//roster:item");
  for (  Node n : nodes) {
    Roster roster;
    try {
      roster=_rosterManager.getRoster(username);
      String jid=n.valueOf("@jid");
      String name=n.valueOf("@name");
      List<String> grouplist=new ArrayList<String>();
      List<Node> groupnodes=findNodesInDocument(n.getDocument(),"//roster:group");
      for (      Node ne : groupnodes) {
        String groupName=ne.getText();
        grouplist.add(groupName);
      }
      boolean rosterPersisten=JiveGlobals.getBooleanProperty("plugin.remoteroster.persistent",false);
      roster.createRosterItem(new JID(jid),name,grouplist,true,rosterPersisten);
      RosterItem getThat=roster.getRosterItem(new JID(jid));
      getThat.setSubStatus(RosterItem.SUB_BOTH);
      roster.updateRosterItem(getThat);
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
  }
}

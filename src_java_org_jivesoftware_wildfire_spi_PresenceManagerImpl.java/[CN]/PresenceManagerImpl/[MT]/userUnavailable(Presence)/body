{
  if (presence.getTo() == null && server.isLocal(presence.getFrom())) {
    String username=presence.getFrom().getNode();
    if (username == null || !userManager.isRegisteredUser(username)) {
      return;
    }
    try {
      User probeeUser=userManager.getUser(username);
      if (!presence.getElement().elements().isEmpty()) {
        probeeUser.getProperties().put(LAST_PRESENCE_PROP,presence.toXML());
      }
      probeeUser.getProperties().put(LAST_ACTIVITY_PROP,String.valueOf(System.currentTimeMillis()));
    }
 catch (    UserNotFoundException e) {
    }
  }
}

{
synchronized (pendingElements) {
    for (    Deliverable deliverable : pendingElements) {
      Collection<Packet> packet=deliverable.getPackets();
      if (packet != null) {
        failDelivery(packet);
      }
    }
    pendingElements.clear();
  }
synchronized (connectionQueue) {
    for (    HttpConnection toClose : connectionQueue) {
      if (!toClose.isDelivered()) {
        Delivered delivered=retrieveDeliverable(toClose.getRequestId());
        if (delivered != null) {
          failDelivery(delivered.getPackets());
        }
 else {
          Log.warn("Packets could not be found for session " + getStreamID() + " cannot "+ "be delivered to client");
        }
      }
      toClose.close();
      fireConnectionClosed(toClose);
    }
  }
}

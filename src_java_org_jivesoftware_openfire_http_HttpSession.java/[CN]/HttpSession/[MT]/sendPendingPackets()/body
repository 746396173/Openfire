{
synchronized (packetsToSend) {
    if (packetsToSend.isEmpty()) {
      return;
    }
    if (router == null) {
      router=new SessionPacketRouter(this);
    }
    for (    Element packet : packetsToSend.remove()) {
      try {
        router.route(packet);
      }
 catch (      UnsupportedEncodingException e) {
        Log.error("Client provided unsupported encoding type in auth request",e);
      }
catch (      UnknownStanzaException e) {
        Log.error("Client provided unknown packet type",e);
      }
    }
  }
}

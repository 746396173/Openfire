{
  RosterItem item=null;
  JID jid=XMPPServer.getInstance().createJID(addedUser,"");
  try {
    item=getRosterItem(jid);
    if (item.getSharedGroups().contains(sharedGroup)) {
      return;
    }
  }
 catch (  UserNotFoundException e) {
    try {
      User user=UserManager.getInstance().getUser(addedUser);
      String nickname="".equals(user.getName()) ? jid.getNode() : user.getName();
      item=new RosterItem(jid,RosterItem.SUB_BOTH,RosterItem.ASK_NONE,RosterItem.RECV_NONE,nickname,null);
      rosterItems.put(item.getJid().toBareJID(),item);
    }
 catch (    UserNotFoundException ex) {
      Log.error("Group (" + sharedGroup + ") includes non-existent username ("+ addedUser+ ")");
    }
  }
  item.addSharedGroup(sharedGroup);
  broadcast(item);
  presenceManager.probePresence(username,item.getJid());
}

{
  sessionManager=SessionManager.getInstance();
  this.username=username;
  Collection<Group> sharedGroups=null;
  try {
    User rosterUser=UserManager.getInstance().getUser(getUsername());
    sharedGroups=GroupManager.getInstance().getGroups(rosterUser);
  }
 catch (  UserNotFoundException e) {
    sharedGroups=new ArrayList<Group>();
  }
  rosterItemProvider=RosterItemProvider.getInstance();
  Iterator items=rosterItemProvider.getItems(username);
  while (items.hasNext()) {
    RosterItem item=(RosterItem)items.next();
    for (    Group group : sharedGroups) {
      if (group.isUser(item.getJid().getNode())) {
        item.addSharedGroup(group.getName());
      }
    }
    rosterItems.put(item.getJid().toBareJID(),item);
  }
  Map<JID,List<String>> sharedUsers=getSharedUsers(sharedGroups);
  for (  JID jid : sharedUsers.keySet()) {
    try {
      User user=UserManager.getInstance().getUser(jid.getNode());
      RosterItem item=new RosterItem(jid,RosterItem.SUB_BOTH,RosterItem.ASK_NONE,RosterItem.RECV_NONE,user.getName(),null);
      for (      String group : sharedUsers.get(jid)) {
        item.addSharedGroup(group);
      }
      rosterItems.put(item.getJid().toBareJID(),item);
    }
 catch (    UserNotFoundException e) {
      Log.error("Groups (" + sharedUsers.get(jid) + ") include non-existent username ("+ jid.getNode()+ ")");
    }
  }
}

{
  String realm;
  String name=null;
  for (int i=0; i < callbacks.length; i++) {
    if (callbacks[i] instanceof RealmCallback) {
      realm=((RealmCallback)callbacks[i]).getText();
      if (realm == null) {
        realm=((RealmCallback)callbacks[i]).getDefaultText();
      }
      Log.debug("XMPPCallbackHandler: RealmCallback: " + realm);
    }
 else     if (callbacks[i] instanceof NameCallback) {
      name=((NameCallback)callbacks[i]).getName();
      if (name == null) {
        name=((NameCallback)callbacks[i]).getDefaultName();
      }
      Log.debug("XMPPCallbackHandler: NameCallback: " + name);
    }
 else     if (callbacks[i] instanceof PasswordCallback) {
      try {
        ((PasswordCallback)callbacks[i]).setPassword(AuthFactory.getPassword(name).toCharArray());
        Log.debug("XMPPCallbackHandler: PasswordCallback");
      }
 catch (      UserNotFoundException e) {
        throw new IOException(e.toString());
      }
catch (      UnsupportedOperationException uoe) {
        throw new IOException(uoe.toString());
      }
    }
 else     if (callbacks[i] instanceof VerifyPasswordCallback) {
      Log.debug("XMPPCallbackHandler: VerifyPasswordCallback");
      VerifyPasswordCallback vpcb=(VerifyPasswordCallback)callbacks[i];
      try {
        AuthToken at=AuthFactory.authenticate(name,new String(vpcb.getPassword()));
        vpcb.setVerified((at != null));
      }
 catch (      UnauthorizedException e) {
        vpcb.setVerified(false);
      }
    }
 else     if (callbacks[i] instanceof AuthorizeCallback) {
      Log.debug("XMPPCallbackHandler: AuthorizeCallback");
      AuthorizeCallback authCallback=((AuthorizeCallback)callbacks[i]);
      String principal=authCallback.getAuthenticationID();
      String username=authCallback.getAuthorizationID();
      if (principal.equals(username)) {
        username=AuthorizationManager.map(principal);
        Log.debug("XMPPCallbackHandler: no username requested, using " + username);
      }
      if (AuthorizationManager.authorize(username,principal)) {
        Log.debug("XMPPCallbackHandler: " + principal + " authorized to "+ username);
        authCallback.setAuthorized(true);
        authCallback.setAuthorizedID(username);
      }
 else {
        Log.debug("XMPPCallbackHandler: " + principal + " not authorized to "+ username);
        authCallback.setAuthorized(false);
      }
    }
 else {
      Log.debug("XMPPCallbackHandler: Callback: " + callbacks[i].getClass().getSimpleName());
      throw new UnsupportedCallbackException(callbacks[i],"Unrecognized Callback");
    }
  }
}

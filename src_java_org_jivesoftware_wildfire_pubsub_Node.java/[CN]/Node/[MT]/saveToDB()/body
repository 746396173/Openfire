{
  if (!savedToDB) {
    PubSubPersistenceManager.createNode(service,this);
    setSavedToDB(true);
    for (    NodeAffiliate affialiate : affiliates) {
      PubSubPersistenceManager.saveAffiliation(service,this,affialiate,true);
    }
    for (    NodeSubscription subscription : subscriptionsByID.values()) {
      PubSubPersistenceManager.saveSubscription(service,this,subscription,true);
    }
    service.addNode(this);
  }
 else {
    PubSubPersistenceManager.updateNode(service,this);
  }
}

{
  IQ reply=IQ.createResultIQ(iqRequest);
  Element childElement=iqRequest.getChildElement().createCopy();
  reply.setChildElement(childElement);
  for (  NodeAffiliate affiliate : affiliates) {
    Collection<NodeSubscription> subscriptions=affiliate.getSubscriptions();
    if (subscriptions.isEmpty()) {
      Element entity=childElement.addElement("entity");
      entity.addAttribute("jid",affiliate.getJID().toString());
      entity.addAttribute("affiliation",affiliate.getAffiliation().name());
      entity.addAttribute("subscription","none");
    }
 else {
      for (      NodeSubscription subscription : subscriptions) {
        Element entity=childElement.addElement("entity");
        entity.addAttribute("jid",subscription.getJID().toString());
        entity.addAttribute("affiliation",affiliate.getAffiliation().name());
        entity.addAttribute("subscription",subscription.getState().name());
        if (isMultipleSubscriptionsEnabled()) {
          entity.addAttribute("subid",subscription.getID());
        }
      }
    }
  }
}

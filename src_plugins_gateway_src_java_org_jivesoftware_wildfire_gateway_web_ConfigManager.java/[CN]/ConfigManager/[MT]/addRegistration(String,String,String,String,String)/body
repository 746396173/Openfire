{
  PluginManager pluginManager=XMPPServer.getInstance().getPluginManager();
  GatewayPlugin plugin=(GatewayPlugin)pluginManager.getPlugin("gateway");
  JID jid;
  if (user.contains("@")) {
    jid=new JID(user);
  }
 else {
    jid=new JID(user,XMPPServer.getInstance().getServerInfo().getName(),null);
  }
  if (!plugin.getTransportInstance(transportType).isEnabled()) {
    return "Transport is not enabled.  Please enable before attempting adds.";
  }
  try {
    plugin.getTransportInstance(transportType).getTransport().addNewRegistration(jid,legacyUsername,legacyPassword,legacyNickname,false);
    return null;
  }
 catch (  UserNotFoundException e) {
    Log.error("Not found while adding account for " + jid.toString());
    return "Unable to find XMPP user account.";
  }
catch (  IllegalAccessException e) {
    Log.error("Domain of JID specified for registration is not on this server: " + jid.toString());
    return "XMPP user account domain is not on this server.";
  }
catch (  IllegalArgumentException e) {
    Log.error("Username specified for registration is not valid.");
    return "Invalid username specified for legacy service.";
  }
}

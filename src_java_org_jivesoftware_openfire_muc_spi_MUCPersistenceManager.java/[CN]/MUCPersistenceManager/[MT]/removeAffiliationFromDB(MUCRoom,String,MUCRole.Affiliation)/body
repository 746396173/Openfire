{
  if (room.isPersistent() && room.wasSavedToDB()) {
    if (MUCRole.Affiliation.member == oldAffiliation) {
      Connection con=null;
      PreparedStatement pstmt=null;
      try {
        con=DbConnectionManager.getConnection();
        pstmt=con.prepareStatement(DELETE_MEMBER);
        pstmt.setLong(1,room.getID());
        pstmt.setString(2,bareJID);
        pstmt.executeUpdate();
      }
 catch (      SQLException sqle) {
        Log.error(sqle.getMessage(),sqle);
      }
 finally {
        try {
          if (pstmt != null)           pstmt.close();
        }
 catch (        Exception e) {
          Log.error(e.getMessage(),e);
        }
        try {
          if (con != null)           con.close();
        }
 catch (        Exception e) {
          Log.error(e.getMessage(),e);
        }
      }
    }
 else {
      Connection con=null;
      PreparedStatement pstmt=null;
      try {
        con=DbConnectionManager.getConnection();
        pstmt=con.prepareStatement(DELETE_AFFILIATION);
        pstmt.setLong(1,room.getID());
        pstmt.setString(2,bareJID);
        pstmt.executeUpdate();
      }
 catch (      SQLException sqle) {
        Log.error(sqle.getMessage(),sqle);
      }
 finally {
        try {
          if (pstmt != null)           pstmt.close();
        }
 catch (        Exception e) {
          Log.error(e.getMessage(),e);
        }
        try {
          if (con != null)           con.close();
        }
 catch (        Exception e) {
          Log.error(e.getMessage(),e);
        }
      }
    }
  }
}

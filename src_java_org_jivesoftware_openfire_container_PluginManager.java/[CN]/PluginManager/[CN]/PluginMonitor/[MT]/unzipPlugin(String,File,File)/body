{
  try (ZipFile zipFile=new JarFile(file)){
    if (zipFile.getEntry("plugin.xml") == null) {
      return;
    }
    dir.mkdir();
    dir.setLastModified(file.lastModified());
    Log.debug("PluginManager: Extracting plugin: " + pluginName);
    for (Enumeration e=zipFile.entries(); e.hasMoreElements(); ) {
      JarEntry entry=(JarEntry)e.nextElement();
      File entryFile=new File(dir,entry.getName());
      if (entry.getName().toLowerCase().endsWith("manifest.mf")) {
        continue;
      }
      if (!entry.isDirectory()) {
        entryFile.getParentFile().mkdirs();
        try (FileOutputStream out=new FileOutputStream(entryFile)){
          try (InputStream zin=zipFile.getInputStream(entry)){
            byte[] b=new byte[512];
            int len;
            while ((len=zin.read(b)) != -1) {
              out.write(b,0,len);
            }
            out.flush();
          }
         }
       }
    }
  }
 catch (  Exception e) {
    Log.error(e.getMessage(),e);
  }
}

{
  RoutableChannelHandler route=null;
  String nodeJID=node.getNode() == null ? "" : node.getNode();
  String resourceJID=node.getResource() == null ? "" : node.getResource();
  if (!serverName.equals(node.getDomain()) && routes.get(node.getDomain()) == null && componentManager.getComponent(node.getDomain()) == null) {
    OutgoingServerSession.authenticateDomain(serverName,node.getDomain());
  }
  routeLock.readLock().lock();
  try {
    Object nameRoutes=routes.get(node.getDomain());
    if (nameRoutes instanceof ChannelHandler) {
      route=(RoutableChannelHandler)nameRoutes;
    }
 else {
      Object resourceRoutes=((Hashtable)nameRoutes).get(nodeJID);
      if (resourceRoutes instanceof ChannelHandler) {
        route=(RoutableChannelHandler)resourceRoutes;
      }
 else       if (resourceRoutes != null) {
        route=(RoutableChannelHandler)((Hashtable)resourceRoutes).get(resourceJID);
      }
 else {
        throw new NoSuchRouteException(node.toString());
      }
    }
  }
 catch (  Exception e) {
    throw new NoSuchRouteException(node == null ? "No node" : node.toString(),e);
  }
 finally {
    routeLock.readLock().unlock();
  }
  if (route == null) {
    throw new NoSuchRouteException(node == null ? "No node" : node.toString());
  }
  return route;
}

{
  try {
    String senderDomain=packet.getFrom().getDomain();
    if (!getAuthenticatedDomains().contains(senderDomain)) {
synchronized (senderDomain.intern()) {
        if (!getAuthenticatedDomains().contains(senderDomain) && !authenticateSubdomain(senderDomain,packet.getTo().getDomain())) {
          returnErrorToSender(packet);
          return;
        }
      }
    }
    if (conn != null && !conn.isClosed()) {
      conn.deliver(packet);
    }
  }
 catch (  Exception e) {
    Log.error(LocaleUtils.getLocalizedString("admin.error"),e);
  }
}

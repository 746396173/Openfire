{
  String username=(String)member;
  try {
    username=Stringprep.nodeprep(username);
    UserManager.getInstance().getUser(username);
  }
 catch (  Exception e) {
    throw new IllegalArgumentException("Invalid user.",e);
  }
  if (adminCollection) {
    if (members.contains(username)) {
      throw new IllegalArgumentException("The user is already a member of the group");
    }
  }
 else {
    if (administrators.contains(username)) {
      throw new IllegalArgumentException("The user is already an admin of the group");
    }
  }
  if (users.add(username)) {
    provider.addMember(name,username,adminCollection);
    if (adminCollection) {
      Map params=new HashMap();
      params.put("admin",username);
      GroupEvent event=new GroupEvent(GroupEvent.EventType.admin_added,Group.this,params);
      GroupEventDispatcher.dispatchEvent(event);
    }
 else {
      Map params=new HashMap();
      params.put("member",username);
      GroupEvent event=new GroupEvent(GroupEvent.EventType.member_added,Group.this,params);
      GroupEventDispatcher.dispatchEvent(event);
    }
    XMPPServer.getInstance().getRosterManager().groupUserAdded(Group.this,username);
    return true;
  }
  return false;
}

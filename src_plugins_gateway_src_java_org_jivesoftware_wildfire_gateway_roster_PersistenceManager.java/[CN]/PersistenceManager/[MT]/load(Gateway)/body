{
  ContactManager contactManager=null;
  Registrar registrar=null;
  try {
    ObjectInputStream is=new ObjectInputStream(new FileInputStream(db));
    contactManager=(ContactManager)is.readObject();
    registrar=(Registrar)is.readObject();
    is.close();
  }
 catch (  Exception e) {
    if (db.exists()) {
      db.delete();
    }
    Log.warn(LocaleUtils.getLocalizedString("persistencemanager.loadrosterfailed","gateway"),e);
  }
 finally {
    this.contactManager=(contactManager != null) ? contactManager : new ContactManager();
    this.registrar=(registrar != null) ? registrar : new Registrar();
    this.registrar.setGateway(gateway);
  }
}

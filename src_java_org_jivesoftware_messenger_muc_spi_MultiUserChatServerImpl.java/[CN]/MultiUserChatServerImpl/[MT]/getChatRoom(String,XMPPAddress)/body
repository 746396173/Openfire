{
  MUCRoom room=null;
synchronized (rooms) {
    room=rooms.get(roomName.toLowerCase());
    if (room == null) {
      room=new MUCRoomImpl(this,roomName,router);
      try {
        MUCPersistenceManager.loadFromDB(room);
      }
 catch (      IllegalArgumentException e) {
        if (isRoomCreationRestricted() && !sysadmins.contains(userjid.toBareStringPrep())) {
          if (!allowedToCreate.contains(userjid.toBareStringPrep())) {
            throw new UnauthorizedException();
          }
        }
        room.addFirstOwner(userjid.toBareStringPrep());
      }
      rooms.put(roomName.toLowerCase(),room);
    }
  }
  return room;
}

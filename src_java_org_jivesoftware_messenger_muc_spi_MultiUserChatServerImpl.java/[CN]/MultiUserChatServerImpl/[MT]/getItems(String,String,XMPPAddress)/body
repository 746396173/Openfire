{
  List answer=new ArrayList();
  if (name == null && node == null) {
    Element item;
    for (    MUCRoom room : rooms.values()) {
      if (room.isPublicRoom()) {
        item=DocumentHelper.createElement("item");
        item.addAttribute("jid",room.getRole().getRoleAddress().toStringPrep());
        item.addAttribute("name",room.getNaturalLanguageName());
        answer.add(item);
      }
    }
synchronized (persistentRoomSurrogateCache) {
      if (persistentRoomSurrogateCache.size() == 0) {
        populateRoomSurrogateCache();
      }
    }
    MUCRoom room;
    for (Iterator it=persistentRoomSurrogateCache.values().iterator(); it.hasNext(); ) {
      room=(MUCRoom)it.next();
      item=DocumentHelper.createElement("item");
      item.addAttribute("jid",room.getRole().getRoleAddress().toStringPrep());
      item.addAttribute("name",room.getNaturalLanguageName());
      answer.add(item);
    }
  }
 else   if (name != null && node == null) {
    MUCRoom room=getChatRoom(name);
    if (room != null && room.isPublicRoom()) {
      MUCRole role;
      Element item;
      for (Iterator<MUCRole> members=room.getOccupants(); members.hasNext(); ) {
        role=members.next();
        item=DocumentHelper.createElement("item");
        item.addAttribute("jid",role.getRoleAddress().toStringPrep());
        answer.add(item);
      }
    }
  }
  return answer.iterator();
}

{
  List<JID> jids=new ArrayList<JID>();
  if (serverName.equals(route.getDomain())) {
    if (route.getResource() != null) {
      ClientRoute clientRoute=usersCache.get(route.toString());
      if (clientRoute == null) {
        clientRoute=anonymousUsersCache.get(route.toString());
      }
      if (clientRoute != null && clientRoute.isAvailable()) {
        jids.add(route);
      }
    }
 else {
      List<String> sessions=usersSessions.get(route.toBareJID());
      if (sessions != null) {
        for (        String jid : sessions) {
          ClientRoute clientRoute=usersCache.get(jid);
          if (clientRoute == null) {
            clientRoute=anonymousUsersCache.get(jid);
          }
          if (clientRoute != null && clientRoute.isAvailable()) {
            jids.add(new JID(jid));
          }
        }
      }
    }
  }
 else   if (route.getDomain().contains(serverName)) {
    byte[] nodeID=componentsCache.get(route.getDomain());
    if (nodeID != null) {
      jids.add(route);
    }
  }
 else {
    jids.add(route);
  }
  return jids;
}

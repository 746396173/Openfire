{
  RoutableChannelHandler route=null;
  if (!serverName.equals(domain) && routes.get(domain) == null && componentManager.getComponent(domain) == null) {
    return OutgoingSessionPromise.getInstance();
  }
  try {
    Object nameRoutes=routes.get(domain);
    if (nameRoutes instanceof ChannelHandler) {
      route=(RoutableChannelHandler)nameRoutes;
    }
 else     if (nameRoutes != null) {
      Object resourceRoutes=((Map)nameRoutes).get(node);
      if (resourceRoutes instanceof ChannelHandler) {
        route=(RoutableChannelHandler)resourceRoutes;
      }
 else       if (resourceRoutes != null) {
        route=(RoutableChannelHandler)((Map)resourceRoutes).get(resource);
      }
 else {
        route=null;
      }
    }
  }
 catch (  Exception e) {
    if (Log.isDebugEnabled()) {
      Log.debug("Route not found for JID: " + jid,e);
    }
  }
  return route;
}

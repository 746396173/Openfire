{
  if (XMPPServer.getInstance().isShuttingDown()) {
  }
 else {
    for (    LocalOutgoingServerSession session : localRoutingTable.getServerRoutes()) {
      String address=session.getAddress().getDomain();
      serversCache.remove(address);
    }
    for (    RoutableChannelHandler componentRoute : localRoutingTable.getComponentRoute()) {
      JID route=componentRoute.getAddress();
      String address=route.getDomain();
      Lock lock=LockManager.getLock(address + "rt");
      try {
        lock.lock();
        Set<byte[]> nodes=componentsCache.get(address);
        if (nodes != null) {
          nodes.remove(server.getNodeID());
          if (nodes.isEmpty()) {
            componentsCache.remove(address);
          }
 else {
            componentsCache.put(address,nodes);
          }
        }
      }
  finally {
        lock.unlock();
      }
    }
    for (    LocalClientSession session : localRoutingTable.getClientRoutes()) {
      boolean anonymous=false;
      JID route=session.getAddress();
      String address=route.toString();
      ClientRoute clientRoute=usersCache.remove(address);
      if (clientRoute == null) {
        clientRoute=anonymousUsersCache.remove(address);
        anonymous=true;
      }
      if (clientRoute != null && route.getResource() != null) {
        Lock lock=LockManager.getLock(route.toBareJID());
        try {
          lock.lock();
          if (anonymous) {
            usersSessions.remove(route.toBareJID());
          }
 else {
            Collection<String> jids=usersSessions.get(route.toBareJID());
            if (jids != null) {
              jids.remove(route.toString());
              if (!jids.isEmpty()) {
                usersSessions.put(route.toBareJID(),jids);
              }
 else {
                usersSessions.remove(route.toBareJID());
              }
            }
          }
        }
  finally {
          lock.unlock();
        }
      }
    }
  }
}

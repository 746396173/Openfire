{
  PluginManager pluginManager=XMPPServer.getInstance().getPluginManager();
  GatewayPlugin plugin=(GatewayPlugin)pluginManager.getPlugin("gateway");
  JID jid;
  if (user.contains("@")) {
    jid=new JID(user);
  }
 else {
    jid=new JID(user,XMPPServer.getInstance().getServerInfo().getName(),null);
  }
  if (!plugin.getTransportInstance(transportType).isEnabled()) {
    return LocaleUtils.getLocalizedString("gateway.web.registrations.notenabled","gateway");
  }
  try {
    plugin.getTransportInstance(transportType).getTransport().addNewRegistration(jid,legacyUsername,legacyPassword,legacyNickname,false);
    return null;
  }
 catch (  UserNotFoundException e) {
    Log.error("Not found while adding account for " + jid.toString());
    return LocaleUtils.getLocalizedString("gateway.web.registrations.xmppnotfound","gateway");
  }
catch (  IllegalAccessException e) {
    Log.error("Domain of JID specified for registration is not on this server: " + jid.toString());
    return LocaleUtils.getLocalizedString("gateway.web.registrations.illegaldomain","gateway");
  }
catch (  IllegalArgumentException e) {
    Log.error("Username specified for registration is not valid.");
    return LocaleUtils.getLocalizedString("gateway.web.registrations.invaliduser","gateway");
  }
}

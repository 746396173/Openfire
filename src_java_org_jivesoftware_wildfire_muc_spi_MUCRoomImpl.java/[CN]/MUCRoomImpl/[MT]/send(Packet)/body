{
  if (packet instanceof Message) {
    roomHistory.addMessage((Message)packet);
    broadcast((Message)packet);
  }
 else   if (packet instanceof Presence) {
    broadcastPresence((Presence)packet);
  }
 else   if (packet instanceof IQ) {
    IQ reply=IQ.createResultIQ((IQ)packet);
    reply.setChildElement(((IQ)packet).getChildElement());
    reply.setError(PacketError.Condition.bad_request);
    router.route(reply);
  }
}

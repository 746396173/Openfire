{
  for (  MUCRole occupant : occupants.values()) {
    if (!occupant.isVoiceOnly()) {
      occupant.send(message);
    }
  }
  if (isLogEnabled()) {
    MUCRole senderRole=null;
    JID senderAddress;
    if (message.getTo() != null && message.getTo().getResource() != null) {
      senderRole=occupants.get(message.getTo().getResource());
    }
    if (senderRole == null) {
      senderAddress=getRole().getRoleAddress();
    }
 else {
      senderAddress=senderRole.getChatUser().getAddress();
    }
    server.logConversation(this,message,senderAddress);
  }
  server.messageBroadcastedTo(occupants.size());
}

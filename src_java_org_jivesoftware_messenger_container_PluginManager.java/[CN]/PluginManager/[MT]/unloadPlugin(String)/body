{
  Log.debug("Unloading plugin " + pluginName);
  Plugin plugin=plugins.get(pluginName);
  if (plugin == null) {
    return;
  }
  File webXML=new File(pluginDirectory,pluginName + File.separator + "web"+ File.separator+ "WEB-INF"+ File.separator+ "web.xml");
  if (webXML.exists()) {
    AdminConsole.removeModel(pluginName);
    PluginServlet.unregisterServlets(webXML);
  }
  File customWebXML=new File(pluginDirectory,pluginName + File.separator + "web"+ File.separator+ "WEB-INF"+ File.separator+ "web-custom.xml");
  if (customWebXML.exists()) {
    PluginServlet.unregisterServlets(customWebXML);
  }
  PluginClassLoader classLoader=classloaders.get(plugin);
  plugin.destroyPlugin();
  classLoader.destroy();
  plugins.remove(pluginName);
  pluginDirs.remove(plugin);
  classloaders.remove(plugin);
}

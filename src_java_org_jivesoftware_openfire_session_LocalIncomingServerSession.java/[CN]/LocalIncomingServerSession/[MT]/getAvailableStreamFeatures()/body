{
  StringBuilder sb=new StringBuilder();
  if (conn.getCompressionPolicy() != Connection.CompressionPolicy.disabled && !conn.isCompressed()) {
    sb.append("<compression xmlns=\"http://jabber.org/features/compress\"><method>zlib</method></compression>");
  }
  boolean usingSelfSigned=false;
  Certificate[] certificates=conn.getLocalCertificates();
  for (  Certificate certificate : certificates) {
    try {
      if (CertificateManager.isSelfSignedCertificate(SSLConfig.getKeyStore(),(X509Certificate)certificate)) {
        usingSelfSigned=true;
      }
    }
 catch (    Exception e) {
    }
  }
  if (usingSelfSigned && ServerDialback.isEnabledForSelfSigned() && validatedDomains.isEmpty()) {
    sb.append("<dialback xmlns=\"urn:xmpp:features:dialback\"/>");
  }
  return sb.toString();
}

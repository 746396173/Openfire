{
  int pendingBytes=session.getScheduledWriteBytes();
  if (pendingBytes > bytesCap) {
    long writeTime=session.getLastWriteTime();
    int pendingRequests=session.getScheduledWriteRequests();
    Log.debug("About to kill session with pendingBytes: " + pendingBytes + " pendingWrites: "+ pendingRequests+ " lastWrite: "+ new Date(writeTime)+ "session: "+ session);
    session.close();
    throw new IOException("Closing session that seems to be stalled. Preventing OOM");
  }
  super.filterWrite(nextFilter,session,writeRequest);
}

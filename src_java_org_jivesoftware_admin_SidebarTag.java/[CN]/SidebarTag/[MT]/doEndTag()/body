{
  ServletRequest request=pageContext.getRequest();
  if (getBodyContent().getString() == null) {
    throw new JspException("Error, no template (body value) set for the sidebar tag.");
  }
  if (subsidebarTag.getBody() == null) {
    throw new JspException("Error, no template (body value) set for the subsidebar tag");
  }
  AdminPageBean pageInfo=(AdminPageBean)request.getAttribute(getBean());
  if (pageInfo != null) {
    String subPageID=pageInfo.getSubPageID();
    String pageID=pageInfo.getPageID();
    if (subPageID != null || pageID != null) {
      if (pageID == null) {
        pageID=AdminConsole.lookupPageID(subPageID);
      }
      if (AdminConsole.getItems().size() > 0) {
        JspWriter out=pageContext.getOut();
        StringBuffer buf=new StringBuffer();
        AdminConsole.Item current=null;
        AdminConsole.Item subcurrent=null;
        if (subPageID != null) {
          subcurrent=AdminConsole.getItem(subPageID);
          pageID=AdminConsole.lookupPageID(subPageID);
        }
        AdminConsole.Item root=AdminConsole.getRootByChildID(pageID);
        current=AdminConsole.getItem(pageID);
        boolean isSubmenu=false;
        if (subPageID != null && current != null) {
          isSubmenu=AdminConsole.isSubMenItem(subcurrent);
        }
        if (root != null) {
          Collection items=root.getItems();
          if (items.size() > 0) {
            buf.append("<ul>");
            for (Iterator iter=items.iterator(); iter.hasNext(); ) {
              AdminConsole.Item item=(AdminConsole.Item)iter.next();
              String header=item.getName();
              String hcss=getHeadercss();
              if (hcss == null) {
                hcss="";
              }
              buf.append("<li class=\"").append(hcss).append("\">").append(clean(header)).append("</li>");
              for (Iterator subitems=item.getItems().iterator(); subitems.hasNext(); ) {
                AdminConsole.Item subitem=(AdminConsole.Item)subitems.next();
                String subitemID=subitem.getId();
                String subitemName=subitem.getName();
                String subitemURL=subitem.getUrl();
                String subitemDescr=subitem.getDescription();
                String value=getBodyContent().getString();
                if (value != null) {
                  value=StringUtils.replace(value,"[id]",clean(subitemID));
                  value=StringUtils.replace(value,"[name]",clean(subitemName));
                  value=StringUtils.replace(value,"[description]",clean(subitemDescr));
                  value=StringUtils.replace(value,"[url]",clean(subitemURL));
                }
                String css=getCss();
                boolean isCurrent=subitem.equals(current);
                boolean showSubmenu=subPageID != null;
                if (isCurrent && !showSubmenu) {
                  css=getCurrentcss();
                }
                buf.append("<li class=\"").append(css).append("\">").append(value).append("</li>");
                if (isSubmenu && isCurrent) {
                  Iterator siblings=subcurrent.getParent().getItems().iterator();
                  boolean hadNext=siblings.hasNext();
                  if (hadNext) {
                    buf.append("<ul class=\"subitems\">\n");
                    String subheader=subcurrent.getParent().getName();
                    buf.append("<li class=\"").append(hcss).append("\">").append(clean(subheader)).append("</li>");
                  }
                  String extraParams=pageInfo.getExtraParams();
                  while (siblings.hasNext()) {
                    AdminConsole.Item sibling=(AdminConsole.Item)siblings.next();
                    String sibID=sibling.getId();
                    String sibName=sibling.getName();
                    String sibDescr=sibling.getDescription();
                    String sibURL=sibling.getUrl();
                    if (extraParams != null) {
                      sibURL+=((sibURL.indexOf('?') > -1 ? "&" : "?") + extraParams);
                    }
                    boolean isSubCurrent=sibling.equals(subcurrent);
                    String subcss=getCss();
                    if (isSubCurrent) {
                      subcss=getCurrentcss();
                    }
                    String svalue=getSubsidebarTag().getBody();
                    if (svalue != null) {
                      svalue=StringUtils.replace(svalue,"[id]",clean(sibID));
                      svalue=StringUtils.replace(svalue,"[name]",clean(sibName));
                      svalue=StringUtils.replace(svalue,"[description]",clean(sibDescr));
                      svalue=StringUtils.replace(svalue,"[url]",clean(sibURL));
                    }
                    buf.append("<li class=\"").append(subcss).append("\">").append(svalue).append("</li>\n");
                  }
                  if (hadNext) {
                    buf.append("<br></ul>\n");
                  }
                }
              }
            }
            buf.append("</ul>");
            try {
              out.write(buf.toString());
            }
 catch (            IOException e) {
              throw new JspException(e);
            }
          }
        }
      }
    }
  }
  return EVAL_PAGE;
}

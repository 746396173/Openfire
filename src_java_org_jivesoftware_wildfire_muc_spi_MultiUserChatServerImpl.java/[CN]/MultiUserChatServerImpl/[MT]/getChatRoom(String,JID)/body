{
  MUCRoom room;
synchronized (roomName.intern()) {
    room=rooms.get(roomName);
    if (room == null) {
      room=new MUCRoomImpl(this,roomName,router);
      try {
        MUCPersistenceManager.loadFromDB((MUCRoomImpl)room);
      }
 catch (      IllegalArgumentException e) {
        if (isRoomCreationRestricted() && !sysadmins.contains(userjid.toBareJID())) {
          if (!allowedToCreate.contains(userjid.toBareJID())) {
            throw new NotAllowedException();
          }
        }
        room.addFirstOwner(userjid.toBareJID());
      }
      rooms.put(roomName,room);
    }
  }
  return room;
}

{
  try {
    List<Packet> response=new ArrayList<Packet>();
    if (packet instanceof IQ) {
      response.addAll(processPacket((IQ)packet));
    }
 else     if (packet instanceof Presence) {
      response.addAll(processPacket((Presence)packet));
    }
 else     if (packet instanceof Message) {
      processPacket((Message)packet);
    }
 else {
      Log.debug("UNHANDLED: " + packet.toString());
    }
    if (response.size() > 0) {
      for (      Packet p : response) {
        componentManager.sendPacket(this,p);
      }
    }
 else {
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    throw new RuntimeException(e);
  }
}

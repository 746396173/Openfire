{
  PresenceType buddyPresenceType=buddyStatuses.get(username);
  if (buddyPresenceType == null || !buddyPresenceType.equals(presenceType)) {
    Presence p=new Presence();
    if (presenceType.equals(PresenceType.unavailable)) {
      p.setType(Presence.Type.unavailable);
    }
    p.setTo(getJID());
    p.setFrom(getTransport().convertIDToJID(username));
    getTransport().sendPacket(p);
  }
  buddyStatuses.put(username,presenceType);
}

{
  try {
    PublishedItem entry;
    boolean success;
    for (int index=0; index <= items_batch_size && !itemsToDelete.isEmpty(); index++) {
      entry=itemsToDelete.poll();
      if (entry != null) {
        success=PubSubPersistenceManager.removePublishedItem(service,entry);
        if (!success) {
          itemsToDelete.add(entry);
        }
      }
    }
    for (int index=0; index <= items_batch_size && !itemsToAdd.isEmpty(); index++) {
      entry=itemsToAdd.poll();
      if (entry != null) {
        success=PubSubPersistenceManager.createPublishedItem(service,entry);
        if (!success) {
          itemsToAdd.add(entry);
        }
      }
    }
  }
 catch (  Throwable e) {
    Log.error(LocaleUtils.getLocalizedString("admin.error"),e);
  }
}

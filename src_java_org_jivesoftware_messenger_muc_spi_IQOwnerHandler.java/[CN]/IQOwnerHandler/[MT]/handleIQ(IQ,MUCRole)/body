{
  if (MUCRole.OWNER != role.getAffiliation()) {
    throw new ForbiddenException();
  }
  IQ reply=packet.createResult();
  Element element=((XMPPDOMFragment)packet.getChildFragment()).getRootElement();
  Element formElement=element.element(QName.get("x","jabber:x:data"));
  if (formElement != null) {
    handleDataFormElement(role,formElement,reply);
  }
 else {
    Element destroyElement=element.element("destroy");
    if (destroyElement != null) {
      room.destroyRoom(destroyElement.attributeValue("jid"),destroyElement.elementTextTrim("reason"));
    }
 else {
      List itemsList=element.elements("item");
      if (!itemsList.isEmpty()) {
        handleItemsElement(itemsList,role,reply);
      }
 else {
        if (!element.elementIterator().hasNext()) {
          refreshConfigurationFormValues();
          reply.setChildFragment(probeResult);
        }
 else {
          reply.setError(XMPPError.Code.BAD_REQUEST);
        }
      }
    }
  }
  router.route(reply);
}

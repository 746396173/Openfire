{
  XmlPullParser xpp=reader.getXPPParser();
  for (int eventType=xpp.getEventType(); eventType != XmlPullParser.START_TAG; ) {
    eventType=xpp.next();
  }
  if ("jabber:client".equals(xpp.getNamespaceUri(xpp.getDepth() - 1))) {
    session=ClientSession.createSession(serverName,reader,connection);
  }
 else   if ("jabber:component:accept".equals(xpp.getNamespaceUri(xpp.getDepth() - 1))) {
    session=ComponentSession.createSession(serverName,reader,connection);
  }
 else {
    Writer writer=connection.getWriter();
    StringBuffer sb=new StringBuffer();
    sb.append("<?xml version='1.0' encoding='");
    sb.append(CHARSET);
    sb.append("'?>");
    sb.append("<stream:error>");
    sb.append("<bad-namespace-prefix xmlns=\"urn:ietf:params:xml:ns:xmpp-streams\"/>");
    sb.append("</stream:error>");
    sb.append("</stream:stream>");
    writer.write(sb.toString());
    writer.flush();
    connection.close();
  }
}
